var e,s,t,a;import{g as i,e as o,a as n,b as r,B as l,u as c,c as u,N as d,I as h,S as p,d as m,f as v,L as y,h as w,i as f,M as g,V as x,O as b,T as j,j as _,s as k,t as S,k as E,R as N,l as T,o as I,m as O,n as A,p as P,q as M,U as L,A as H,r as V,v as z,w as $,x as C}from"./app-lib-DSCnMy5L.js";import{q as B,J as U,K as F,m as q,f as G}from"./vendor-base-1ai8Q9Az.js";import{j as D,o as R,i as K,k as W,p as J,q as X,B as Z,r as Y,R as Q,C as ee,F as se,s as te,S as ae,t as ie,v as oe,n as ne,m as re}from"./vendor-other-C1ShmSlc.js";import"./vendor-xml-jqs4059G.js";import"./vendor-intl-fh-Ve3fo.js";function le(e){const s=r();return D.jsxs(R,{fluid:!0,className:"account-status",children:[D.jsx("div",{className:"row-label",id:"user-full-name",children:"Name:"}),D.jsx("div",{"aria-labelledby":"user-full-name",children:s.user.full_name||"-"}),D.jsx("div",{className:"row-label",id:"user-email",children:"Email:"}),D.jsx("div",{"aria-labelledby":"user-email",children:s.user.email||"-"})]})}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();const ce=class extends l{initialize(e,s){super.initialize(e,s),this.session=s.session}};ce.NAME="vapp-auth-ready";let ue=ce;const de=class extends l{initialize(e,s){super.initialize(e,s),this.session=s.session}};de.NAME="vapp-auth-change";let he=de;const pe=class extends l{initialize(e,s){super.initialize(e,s),this.session=s.session}};pe.NAME="vapp-auth-login";let me=pe;const ve=i("auth");function ye({lmsconfig:e="IMeLms",...s}){const t=c();return D.jsxs(R,{fluid:!0,className:"p-0",children:[D.jsx("div",{children:"Enter your email below, and we'll send reset instructions to you."}),D.jsx(K,{validateOnChange:!1,validateOnBlur:!1,initialValues:{email:""},onSubmit:async(s,a)=>{try{const a=u("account","v1");await a.post({path:"auth/reset_password",data:{email:s.email,app:o.VOSHI_APP,build:o.VOSHI_BUILD,lmsconfig:e}}),t.addToast(`A password reset code has been sent to ${s.email}. Look for it in your inbox and other (spam) folders.`),t.close()}catch(i){a.setFieldError("non_field_errors",i),ve.error(i)()}},children:e=>D.jsx(W,{children:D.jsx(we,{form:e})})})]})}const we=({form:e,...s})=>{const t=c();return D.jsxs(R,{fluid:!0,className:"p-0",children:[D.jsx(d,{className:"text-red-900 mt-1 text-center"}),D.jsx(J,{className:"mt-1 g-0",children:D.jsx(X,{children:D.jsx(h,{name:"email",type:"email",label:"Email",autoFocus:!0,disabled:e.isSubmitting})})}),D.jsx(J,{className:"mt-2 g-0",children:D.jsxs(X,{className:"d-flex justify-content-end",children:[D.jsx(Z,{variant:"gray-tertiary",onClick:e=>{t.close()},children:"Cancel"}),D.jsx(p,{variant:"green-primary",className:"ms-0p5",children:"Send Code"})]})})]})},fe=i("auth");function ge(e){const s=r(),t=Y(),a=c(),i=m();return D.jsx(K,{validateOnChange:!1,validateOnBlur:!1,initialValues:{email:"",password:""},onSubmit:async(e,a)=>{try{const a=await s.authenticate({issuer:i.config.issuer||i.getAttribute("issuer"),email:e.email,password:e.password},["password-login"]);await s.login(a),me.dispatch(i,{session:s}),t.push("/")}catch(o){fe.warn(`Authentication failed: ${v(o)}`)(),await s.logout(),a.setFieldError("non_field_errors",v(o))}},children:e=>D.jsx(W,{children:D.jsx(xe,{form:e,ctxModal:a})})})}const xe=({form:e,ctxModal:s,...t})=>D.jsxs(R,{fluid:!0,className:"login-container",children:[D.jsx(J,{className:"login-email",children:D.jsx(X,{className:"login-email",children:D.jsx(h,{name:"email",label:"Email",autoFocus:!0,onChange:s=>{e.errors.non_field_errors&&e.setFieldError("non_field_errors",null)}})})}),D.jsx(J,{className:"login-password",children:D.jsx(X,{className:"login-password",children:D.jsx(h,{name:"password",type:"password",label:"Password",onChange:s=>{e.errors.non_field_errors&&e.setFieldError("non_field_errors",null)}})})}),e.errors.non_field_errors&&D.jsx(J,{className:"login-error",children:D.jsx(X,{className:"login-error",children:e.errors.non_field_errors})}),D.jsxs(J,{className:"login-submit",children:[D.jsx(X,{className:"login-reset",children:D.jsx(Z,{variant:"link","aria-label":"Open the reset password dialog",onClick:t=>{s.dialog("Reset Password",D.jsx(ye,{email:e.values.email}),null)},children:"Reset Password"})}),D.jsx(X,{className:"login-submit",children:D.jsx(p,{label:"Login"})})]})]}),be=i("auth");function je(e){const s=r(),t=Y();return Q.useEffect((()=>{be.info("logging out")(),s.logout().then((()=>{t.push("/login")}))}),[]),D.jsx("div",{className:"pt-4",children:D.jsx(y,{})})}function _e(e){const s=Y(),t=B.parse(s.location.search);return t.userid&&t.code?D.jsxs(R,{fluid:!0,className:"p-0",children:[D.jsx("div",{className:"fs-1p1 mt-1 mb-2",children:"Please enter a new password in the boxes below:"}),D.jsx(K,{validateOnChange:!1,validateOnBlur:!1,initialValues:{password:"",password2:""},validate:e=>{const s={};return!e.password||e.password.length<8?s.password="Please use at least 8 letters in the password":e.password!==e.password2&&(s.password2="Please ensure the passwords match"),s},children:e=>D.jsx(W,{children:D.jsx(ke,{form:e})})})]}):D.jsx(ee.Body,{children:"This password request is not valid."})}i("auth");const ke=e=>D.jsxs(R,{fluid:!0,children:[D.jsx(J,{className:"mt-1",children:D.jsx(X,{children:D.jsx(h,{name:"password",type:"password",label:"Enter a new password",autoFocus:!0,disabled:e.form.isSubmitting})})}),D.jsx(J,{className:"mt-1",children:D.jsx(X,{children:D.jsx(h,{name:"password2",type:"password",label:"Reenter the password",disabled:e.form.isSubmitting})})}),D.jsx(J,{className:"mt-1p5",children:D.jsx(X,{className:"text-center",children:D.jsx(p,{label:"Submit"})})})]}),Se=i("token");function Ee(e){const s=Q.useRef();return D.jsxs(D.Fragment,{children:[D.jsx(K,{validateOnChange:!1,validateOnBlur:!1,innerRef:s,initialValues:{state_token:"",_parsed_state_token:null},validate:e=>{const s={};if(e._shard=-1,e.state_token){const s=e.state_token.split("-").slice(0,3),a=`I${s[0]}${s[1]}`;try{e._shard=w(a)[2]}catch(t){Se.error("unable to unpack shard, so iterating all servers: {}",t)()}e._parsed_state_token=s.slice(0,3).join("-")}else s.state_token="Please enter a start code.";return s},onSubmit:async(e,t)=>{var a,i;const n=r();let l=null,c=null,u=Object.values(f);f[parseInt(e._shard)]&&u.unshift(f[parseInt(e._shard)]),u=u.filter(((e,s)=>u.indexOf(e)===s));for(const s of u){Se.debug("trying API server: {}",s)();try{const t=await n.authenticate({state_token:e._parsed_state_token,platform:o.VOSHI_PLATFORM,baseUrl:`https://${s}/account/v1`},["state-token"]);return await n.login(t),Se.debug("redirecting to {}",t.redirect_uri)(),void(window.location.href=t.redirect_uri)}catch(d){l=d||l,c=(null==(i=null==(a=d.response)?void 0:a.data)?void 0:i.detail)||c||"Invalid code"}}Se.error(l)(),s.current.setFieldError("state_token",c)},children:e=>D.jsx(se,{onSubmit:e.handleSubmit,children:D.jsx(Ne,{form:e})})}),D.jsx(Te,{})]})}const Ne=({form:e,...s})=>D.jsxs(R,{fluid:!0,className:"p-0",children:[D.jsx(J,{children:D.jsx(X,{className:"text-gray-500",children:"Welcome! Begin by getting a start code from your course pages."})}),D.jsx(J,{className:"mt-2 justify-content-center",children:D.jsx(X,{className:"flex-minimal",children:D.jsx(h,{name:"state_token",placeholder:"Enter start code...",autoFocus:!0,style:{maxWidth:"360px"},errorProps:{className:"text-gray-200"}})})}),D.jsx(J,{className:"mt-3 justify-content-center",children:D.jsx(X,{className:"flex-minimal",children:D.jsx(p,{label:"Start",disabled:!e.values.state_token,variant:"blue-secondary"})})})]}),Te=e=>D.jsxs(R,{fluid:!0,className:"text-gray-500 fs-0p9",style:{maxWidth:"480px"},children:[D.jsx(J,{className:"mt-3",children:D.jsx(X,{children:"This page provides access to course assessments at Voshi.com."})}),D.jsx(J,{className:"mt-1p5",children:D.jsx(X,{children:"Usage requires a start code from a participating course at your organization. If you do not have a code, please contact your instructor or email support:"})}),D.jsx(J,{className:"mt-1p5",children:D.jsx(X,{className:"font-monospace text-center",children:"support@voshi.com"})})]});function Ie(e){const s=te();return D.jsxs(ae,{children:[D.jsx(ie,{path:s.path,exact:!0,component:le}),D.jsx(ie,{path:`${s.path}/login`,component:ge}),D.jsx(ie,{path:`${s.path}/logout`,component:je}),D.jsx(ie,{path:`${s.path}/reset`,component:_e}),D.jsx(ie,{path:`${s.path}/token`,component:Ee}),D.jsx(ie,{children:D.jsx(g,{message:"This page has left the building."})})]})}function Oe(e){return D.jsxs(ae,{children:[D.jsx(ie,{path:"/account",component:Ie}),D.jsx(ie,{path:"/login",children:D.jsx(oe,{to:"/account/login"})}),D.jsx(ie,{path:"/logout",children:D.jsx(oe,{to:"/account/logout"})}),D.jsx(ie,{path:"/",exact:!0,children:D.jsx(oe,{to:"/account"})}),D.jsx(ie,{children:D.jsx(g,{className:"mt-4",message:"This page has left the building."})})]})}const Ae="x-voshi-id",Pe="application/json",Me=i("api-client"),Le="1"===o.VOSHI_DISABLE_OBF3||"true"===o.VOSHI_DISABLE_OBF3;class He{constructor(e){if(!(e=e||{}).api_app)throw new x("api_app is a required option");this.api_domain=e.api_domain,this.api_app=e.api_app,this.api_version=e.api_version||"v1",this.authscheme=e.authscheme||"Bearer",this.sessionid=e.sessionid,this.basePath=e.basePath||`https://${this.api_domain}/${this.api_app}/${this.api_version}`,this.headers=e.headers||void 0}get(e){return this.request("GET",e)}post(e){return this.request("POST",e)}put(e){return this.request("PUT",e)}patch(e){return this.request("PATCH",e)}delete(e){return this.request("DELETE",e)}async request(e,s=void 0){s=s||{},(s={authscheme:this.authscheme,sessionid:this.sessionid,path:void 0,url:void 0,params:void 0,data:void 0,body:void 0,onProgress:void 0,...s,method:e,headers:{Accept:[Le?null:b,Pe,"text/html","*/*"].filter((e=>!!e)).join(","),"Content-Type":Le?Pe:b,...this.headers,...s.headers,"x-voshi-app":o.appsig,"x-client-offset":j.current}}).url=s.url||_(this.basePath,s.path),s.sessionid&&(s.headers.Authorization=`${s.authscheme} ${s.sessionid}`);const t=k(s);s.onProgress&&t.addObserver(s.onProgress);const a=await t.promise;try{let e=S(a.getHeader("Date"))-72e5;if(!e)throw new x('missing "Date" response header');e+=500;const s=Date.now()-e;j.current=Math.abs(s)<1e4?0:s}catch(i){Me.warn("unable to parse server time: {}",i.toString())()}return a}async verifyToken(e){const s=await this.getKeySet(!1);let t=[];for(const i of s)try{return(await U(e,i)).payload}catch(a){t.push(a)}throw new Error(`JWT validation failed [${t.join(";")}]`)}getKeySet(e=!1){const s=`_keyset__${this.api_domain}`;let t=E.get(s);return t&&!e||(t=async function(e){try{const s=await e.get({url:`https://${e.api_domain}/lti13/${e.api_version}/jwks`}),t=[];for(const e of s.data.keys)t.push(await F(e));return t}catch(s){throw new Error(`unable to download keyset: ${s.toString()}`,{cause:s})}}(this),E.set(s,t)),t}}class Ve{constructor(e,s,t,a){this.source=null,this.access=null,this.session=e,this.app=s,this.target=t,this.action=a}get code(){return`${this.app}.${this.target}.${this.action}.${this.access}`}toString(){return this.code}isMatch(){return!1}}class ze extends Ve{constructor(){super(...arguments),this.source="account"}isMatch(){return this.session.credentials.account.permissions.has(this.code)}}class $e extends Ve{constructor(){super(...arguments),this.source="user"}isMatch(){return this.session.credentials.user.permissions.has(this.code)}}class Ce extends Ve{constructor(){super(...arguments),this.source="member"}isMatch(){return this.session.credentials.member.permissions.has(this.code)}}class Be extends Ve{constructor(){super(...arguments),this.source="empty",this.access="empty"}isMatch(){return!0}}const Ue=[class extends ze{constructor(){super(...arguments),this.access="all"}isMatch(){return!!this.session.credentials.is_superuser||super.isMatch()}},class extends $e{constructor(){super(...arguments),this.access="all"}},class extends Ce{constructor(){super(...arguments),this.access="all"}},class extends ze{constructor(){super(...arguments),this.access="lms"}},class extends $e{constructor(){super(...arguments),this.access="lms"}},class extends Ce{constructor(){super(...arguments),this.access="lms"}},class extends ze{constructor(){super(...arguments),this.access="scope"}},class extends $e{constructor(){super(...arguments),this.access="scope"}},class extends Ce{constructor(){super(...arguments),this.access="scope"}},class extends ze{constructor(){super(...arguments),this.access="user"}},class extends $e{constructor(){super(...arguments),this.access="user"}},class extends Ce{constructor(){super(...arguments),this.access="user"}},Be],Fe=q.BareMixin((e=>class extends e{hasPermission(e,s,t){return"empty"!==this.checkPermission(e,s,t).access}checkPermission(e,s,t){if(this.credentials)for(const a of Ue){const i=new a(this,e,s,t);if(i.isMatch())return i}return new Be(this,e,s,t)}get groupsList(){const e=new Set;return this.credentials&&(this.credentials.account.groups.forEach(e.add,e),this.credentials.user.groups.forEach(e.add,e),this.credentials.member.groups.forEach(e.add,e)),e}}));class qe extends Error{}class Ge extends qe{}const De=class{constructor(e){this.session=e,this.log=i("auth").getLogger(this.constructor.key),this.sessionid=null,this.userjwt=null,this.userdata=null}async proposeSessionId(e,s="Bearer"){let t;this.sessionid=null,this.userjwt=null,this.userdata=null;try{const a=this.session.apiClient({api_app:"account",api_version:"v1",api_domain:o.VOSHI_LINK_API,authscheme:s,sessionid:e});t=await a.get({path:"session"})}catch(a){throw new qe(a instanceof N?"unable to connect to DAPI server":"proposed session id rejected by DAPI",{cause:a})}if(!t.getHeader(Ae))throw new qe("authentication succeeded, but response is missing session header");try{const e=this.session.apiClient({api_app:"account",api_version:"v1",api_domain:o.VOSHI_LINK_API,sessionid:t.getHeader(Ae)});this.userdata=await e.verifyToken(t.body),this.userjwt=t.body,this.sessionid=t.getHeader(Ae)}catch(a){throw new qe("unable to decode JWT from server",{cause:a})}}async load(e){throw new qe("source failed to implement load method")}async save(){throw new qe("source failed to implement save method")}};De.key=null;let Re=De;const Ke=((e=class extends Re{async load(e){this.log.debug("authenticating with anonymous user")();try{await this.proposeSessionId("")}catch(s){throw new Ge(`anonymous session should not have failed validation: ${s}`,{cause:s})}}async save(){}}).key="anonymous",e),We=class extends Re{async load(e){this.sessionid=T(S()),this.userdata=e,this.userjwt=null}async save(){}};We.key="force-auth";let Je=We;const Xe=class extends Re{async load(e){if(!e.session_id)throw new qe("session_id must be specified in the params");this.log.debug("proposing a potential session id")(),await this.proposeSessionId(e.session_id)}async save(){}};Xe.key="specified-sessionid";let Ze=Xe;const Ye=class extends Re{async load(e){if(!e.session_jwe)throw new qe("session_jwe must be specified in the params");this.log.debug("proposing a potential session id")(),await this.proposeSessionId(e.session_jwe,"JWE")}async save(){}};Ye.key="specified-sessionjwe";let Qe=Ye;const es=class extends Re{async load(e){let s,t;try{s=localStorage.getItem(Ae)}catch(a){throw new qe("localStorage not accessible",{cause:a})}if(!s)throw new qe("no saved session data found");try{t=I(s)}catch(a){throw this.log.error(a)(),new qe("unable to decode session data",{cause:a})}if(!t||!t.sessionid)throw new qe("sessionid not in saved auth");this.log.debug("proposing a potential session id")(),await this.proposeSessionId(t.sessionid)}async save(){const e=this.session.transient||!this.session.authenticated?{sessionid:null,ts:S()}:{sessionid:this.session.sessionid||null,ts:S()};let s;try{s=O(e)}catch(t){throw this.log.error(t)(),new qe("unable to encode auth data",{cause:t})}try{localStorage.setItem(Ae,s)}catch(t){throw new qe("localStorage not accessible",{cause:t})}}};es.key="local-storage";let ss=es;const ts=class extends Re{async load(e){if(!this.constructor.enabled)throw new qe("source not enabled");if("ready"!==A.status)throw new qe("skipped because not running as an addin");if(A.isDialogApi)throw new qe("skipped because running in an addin dialog");this.log.debug("getting custom props: {}",this.constructor.key)();const s=await P(this.constructor.key);if(!s)throw new qe("session id not found in custom data");if(!s.sessionid)throw new qe("envelope found in custom data, but session id not found within it");this.log.debug("proposing a potential session id")(),await this.proposeSessionId(s.sessionid)}async save(){try{if("ready"!==A.status||A.isDialogApi)return;this.log.debug("saving session id")();const e=this.session.transient||!this.session.authenticated?{sessionid:null,ts:S()}:{sessionid:this.session.sessionid||null,ts:S()};await M(this.constructor.key,e)}catch(e){this.log.info(e)()}}};ts.key="ms-office",ts.enabled="addin"===o.VOSHI_PLATFORM;let as=ts;const is=((s=class extends Re{async load(e){let s;this.log.debug("authenticating with email/password")();const t=u("account","v1");s=await t.post({path:"/login",data:{issuer:e.issuer||"",email:e.email,password:e.password||""}});const a=s.getHeader(Ae);if(!a)throw new qe("authentication succeeded, but response is missing session header");this.log.debug("proposing a potential session id")(),await this.proposeSessionId(a)}async save(){}}).key="password-login",s),os=((t=class extends Re{async load(e){if(!e.userid)throw new qe("userid is required for this source");if(!e.code)throw new qe("code is required for this source");if(!e.password)throw new qe("password is required for this source");let s;this.log.debug("authenticating via password reset")();const t=u("account","v1");s=await t.post({path:"reset_password2",data:{userid:e.userid,code:e.code,password:e.password}});const a=s.getHeader(Ae);if(!a)throw new qe("authentication succeeded, but response is missing session header");this.log.debug("proposing a potential session id")(),await this.proposeSessionId(a)}async save(){}}).key="password-reset",t),ns=class extends Re{async load(e){let s,t;try{s=sessionStorage.getItem(Ae)}catch(a){throw new qe("sessionStorage not accessible",{cause:a})}if(!s)throw new qe("no saved session data found");try{t=I(s)}catch(a){throw this.log.error(a)(),new qe("unable to decode session data",{cause:a})}if(!t||!t.sessionid)throw new qe("sessionid not in saved auth");this.log.debug("proposing a potential session id")(),await this.proposeSessionId(t.sessionid)}async save(){const e={sessionid:this.session.sessionid||null,ts:S()};let s;try{s=O(e)}catch(t){throw this.log.error(t)(),new qe("unable to encode auth data",{cause:t})}try{sessionStorage.setItem(Ae,s)}catch(t){throw new qe("sessionStorage not accessible",{cause:t})}}};ns.key="session-storage";let rs=ns;const ls="state_token",cs=((a=class extends Re{async load(e){var s;const t=B.parse(window.location.search),a=t[ls];if(!a)throw new qe("state token not in url");let i;this.log.info("cleaning the state token from the querystring")(),delete t[ls],this.log.debug("authenticating with state token")();try{const e=u("lti13","v1",t.baseUrl?{baseUrl:t.baseUrl}:void 0);i=await e.post({path:"token",data:{state_token:a}})}catch(n){throw((null==(s=n.response)?void 0:s.status)||500)<500?new Ge("state token failed to authenticate",{cause:n}):n}const o=i.getHeader(Ae);if(!o)throw new qe("authentication succeeded, but response is missing session header");this.log.debug("proposing a potential session id")();try{await this.proposeSessionId(o)}catch(n){throw new Ge("proposed sessionid failed to validate",{cause:n})}}async save(){}}).key="state-token",a),us=new Map;us.set(Ke.key,Ke),us.set(Je.key,Je),us.set(Ze.key,Ze),us.set(Qe.key,Qe),us.set(ss.key,ss),us.set(as.key,as),us.set(is.key,is),us.set(os.key,os),us.set(rs.key,rs),us.set(cs.key,cs);const ds=i("session"),hs=["state-token","local-storage","session-storage","ms-office","anonymous"],ps=class extends(Fe(Object)){constructor(e){super(),this._onNextUser=e=>{this.user=e,this.webcomp&&he.dispatch(this.webcomp,{session:this})},this.webcomp=e,this.reset()}reset(){this.ready=!1,this.source_key=null,this.login_type=null,this.transient=!0,this.auth_context=null,this.sessionid=null,this.credentials=null,this.user=null}get authenticated(){var e;return!!(null==(e=this.user)?void 0:e.is_authenticated)}getSource(e){const s=us.get(e);if(!s)throw new Error(`unknown auth source: ${e}`);return new s(this)}async authenticate(e=null,s=null){ds.debug("authenticating via auth sources")(),s=s||hs;for(const a of s){const s=this.getSource(a);try{return await s.load(e),ds.info("authenticated via source: {}",a)(),s}catch(t){if(t instanceof Ge)throw ds.info("{} terminated authentication process: {}",a,t.toString())(),t;if(!(t instanceof qe))throw t;ds.info("{} did not authenticate: {}",a,t.toString())()}}throw ds.info("unable to authenticate via sources: {}",s.join(", "))(),new qe(`Unable to authenticate via sources: ${s.join(", ")}`)}async login(e){if(!e||!e.sessionid||!e.userdata)throw new Error("unable to login with invalid auth source.");this.authSource=e,this.transient=!!e.userdata.transient,this.auth_context=e.userdata.auth_context||null,this.sessionid=e.sessionid,this.groups=e.userdata.groups,this.user=new L(e.userdata.user,{onNext:this._onNextUser}),ds.force(this.authenticated?"session is authenticated":"session is anonymous")(),ds.force({authenticated:this.authenticated,name:this.user.full_name||"-",email:this.user.email||"-",user:this.user.id||"-"})(),ds.debug("sources saving current state")();for(const t of us.keys()){const e=this.getSource(t);try{await e.save()}catch(s){if(!(s instanceof qe))throw s;ds.info("{} failed to save auth state: {}",t,s.message)()}}this.ready?this.webcomp&&he.dispatch(this.webcomp,{session:this}):(this.ready=!0,this.webcomp&&ue.dispatch(this.webcomp,{session:this}))}async logout(){this.sessionid=null;const e=await this.authenticate(null,["anonymous"]);await this.login(e)}apiClient(e){return new He({api_domain:o.VOSHI_DOMAIN_API,api_app:"uid",api_version:"v1",sessionid:this.sessionid,...e})}};ps.TYPE="AuthSession";let ms=ps;async function vs(e,s=null,t=null){let a=window[H];return a||(a=window[H]=new ms(e),new Promise(((e,i)=>{setTimeout((()=>{a.authenticate(s,t).catch(i).then((s=>{a.login(s).catch(i).then((()=>{e(a)}))}))}),25)})))}const ys={en:{FnfezUqXGjMI:[{type:0,value:"across the "},{type:1,value:"subs"},{type:0,value:" most recent "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:"."}],Vn6sjvEwHkZK:[{type:1,value:"count"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"record"}]},other:{value:[{type:0,value:"records"}]}},pluralType:"cardinal",type:6,value:"count"},{type:0,value:"."}],Vrh8f2BVOLwy:[{type:0,value:"Search"}],"admin.pages.search.form.placeholder":[{type:0,value:"Search"}],c_3Gzhj7KLHI:[{type:1,value:"subs"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:" allowed."}],"epoch.duration.days":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"day"}]},other:{value:[{type:0,value:"days"}]},two:{value:[{type:0,value:"days"}]},zero:{value:[{type:0,value:"days"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.hours":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"hour"}]},other:{value:[{type:0,value:"hours"}]},two:{value:[{type:0,value:"hours"}]},zero:{value:[{type:0,value:"hours"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.millis":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"millisecond"}]},other:{value:[{type:0,value:"milliseconds"}]},two:{value:[{type:0,value:"milliseconds"}]},zero:{value:[{type:0,value:"milliseconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.minutes":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"minute"}]},other:{value:[{type:0,value:"minutes"}]},two:{value:[{type:0,value:"minutes"}]},zero:{value:[{type:0,value:"minutes"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.seconds":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"second"}]},other:{value:[{type:0,value:"seconds"}]},two:{value:[{type:0,value:"seconds"}]},zero:{value:[{type:0,value:"seconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.weeks":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"week"}]},other:{value:[{type:0,value:"weeks"}]},two:{value:[{type:0,value:"weeks"}]},zero:{value:[{type:0,value:"weeks"}]}},pluralType:"cardinal",type:6,value:"num"}],fkUMsTGn8rzM:[{type:0,value:"asdfasdf"}],"reader.pages.index.noauth":[{type:0,value:"Not authenticated: please launch from your LMS."}]},es:{FnfezUqXGjMI:[{type:0,value:"across the "},{type:1,value:"subs"},{type:0,value:" most recent "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:"."}],Vn6sjvEwHkZK:[{type:1,value:"count"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"record"}]},other:{value:[{type:0,value:"records"}]}},pluralType:"cardinal",type:6,value:"count"},{type:0,value:"."}],Vrh8f2BVOLwy:[{type:0,value:"Search"}],"admin.pages.search.form.placeholder":[{type:0,value:"Search"}],c_3Gzhj7KLHI:[{type:1,value:"subs"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:" allowed."}],"epoch.duration.days":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"day"}]},other:{value:[{type:0,value:"days"}]},two:{value:[{type:0,value:"days"}]},zero:{value:[{type:0,value:"days"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.hours":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"hour"}]},other:{value:[{type:0,value:"hours"}]},two:{value:[{type:0,value:"hours"}]},zero:{value:[{type:0,value:"hours"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.millis":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"millisecond"}]},other:{value:[{type:0,value:"milliseconds"}]},two:{value:[{type:0,value:"milliseconds"}]},zero:{value:[{type:0,value:"milliseconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.minutes":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"minute"}]},other:{value:[{type:0,value:"minutes"}]},two:{value:[{type:0,value:"minutes"}]},zero:{value:[{type:0,value:"minutes"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.seconds":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"second"}]},other:{value:[{type:0,value:"seconds"}]},two:{value:[{type:0,value:"seconds"}]},zero:{value:[{type:0,value:"seconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.weeks":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"week"}]},other:{value:[{type:0,value:"weeks"}]},two:{value:[{type:0,value:"weeks"}]},zero:{value:[{type:0,value:"weeks"}]}},pluralType:"cardinal",type:6,value:"num"}],fkUMsTGn8rzM:[{type:0,value:"Not authenticated: please launch from your LMS."}],"reader.pages.index.noauth":[{type:0,value:"Not authenticated: please launch from your LMS."}]}};G.setOptions({strict:!1});const ws=i("auth"),fs=class extends V{connectedCallback(){var e;this.hasAttribute("primary")&&(this.config.session_id?vs(this,{session_id:this.config.session_id},["specified-sessionid"]).catch((e=>{ws.error("Unable to initialize auth: {}",e)()})):this.config.session_jwe?vs(this,{session_jwe:this.config.session_jwe},["specified-sessionjwe"]).catch((e=>{ws.error("Unable to initialize auth: {}",e)()})):vs(this,null==(e=null==window?void 0:window.location)?void 0:e.search).catch((e=>{ws.error("Unable to initialize auth: {}",e)()}))),super.connectedCallback()}disconnectedCallback(){this.hasAttribute("primary")&&function(e){const s=window[H];s&&s.webapp===e&&(s.webapp=null,s.reset(),delete window[H])}(this),super.disconnectedCallback()}};fs.ELEMENT_NAME="AuthElement",fs.ELEMENT_TAG=`vapp-${o.VOSHI_APP}`,fs.REACT_COMPONENT=function({webcomp:e,...s}){if(e.hasAttribute("primary"))return null;const t=e.isStandalone?ne:re;return D.jsx(z,{messages:ys,children:D.jsx(t,{basename:o.VOSHI_APP_PATH,initialIndex:0,initialEntries:[e.config.path||"/"],children:D.jsx($,{initializing:D.jsx(y,{className:"my-4"}),children:()=>D.jsx(C,{children:D.jsx(Oe,{})})})})})},fs.CONFIG={...V.CONFIG,session_id:void 0,session_jwe:void 0,issuer:void 0},fs.ATTRIBUTES={...V.ATTRIBUTES,primary:void 0,issuer:void 0},function(e){const s=i("voshi");try{if(!o.VOSHI_APP)throw new Error("environment is missing VOSHI_APP");if(!o.VOSHI_STAGE)throw new Error("environment is missing VOSHI_STAGE");if(!o.VOSHI_BUILD)throw new Error("environment is missing VOSHI_BUILD");if(!o.VOSHI_PLATFORM)throw new Error("environment is missing VOSHI_PLATFORM");s.force("welcome to {}",o.appsig)(),o.appsig!==n.appsig&&s.force("built as {}",n.appsig)(),customElements.get(e.ELEMENT_TAG)?s.info(`custom element already defined for <${e.ELEMENT_TAG}>`)():(s.info(`defining custom element ${e.ELEMENT_NAME} for <${e.ELEMENT_TAG}>`)(),customElements.define(e.ELEMENT_TAG,e))}catch(t){s.error("Error loading app",t)()}}(fs);
