import{g as e,e as s,a as t,c as a,n,b as i,I as l,k as o,d as r,E as c,i as u,M as d,B as p,L as h,A as m,f as g,F as v,h as y}from"./app-lib-DAA4CQTo.js";import{f as x}from"./vendor-base-DgWPobNI.js";import{R as f,J as b,j,r as w,B as S,C as N,g as k,F as C,K as E,O as T,P as I,Q as z}from"./vendor-other-DrJ9GjtN.js";import"./vendor-markdown-CwIoXbGH.js";import{P as M}from"./vendor-codetools-IBYMTqVU.js";import"./vendor-xml-0NFUgpxB.js";import"./vendor-intl-D9Vieko5.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();const L=f.createContext({});function _(){return f.useContext(L).instance}L.displayName="ChatContext",a(L,"_chat_context_wrapper",(e=>{e.ctxChat=e._chat_context_wrapper.instance}));const A=e("ai-chat"),P=b(class extends f.PureComponent{constructor(){super(...arguments),this.coursenum=this.props.coursenum||"null",this.page_id=this.props.pageid,this.user_id=this.props.userid,this.full_page=this.props.full_page||!1,this.processing=!1,this.msgs=[],this.suggestions=[],this.feedback="neutral",this.learningStyle=localStorage.getItem("botLearningStyle-"+this.coursenum)||"default",this.conciseness=localStorage.getItem("botConciseness-"+this.coursenum)||"default",this.language=localStorage.getItem("botLanguage-"+this.coursenum)||"english",this.quizPreference=localStorage.getItem("botQuizPreference-"+this.coursenum)||"multiple-choice",this.firstUsage=JSON.parse(localStorage.getItem("botInitialUsage-"+this.coursenum))||!0,this.messageType="chat",this.state={renderCounter:-1,displayWin:"true"===localStorage.getItem("chatDisplayWin-"+this.coursenum),displaySettings:!1,displayFeedback:!1,expanded:"true"===localStorage.getItem("chatExpanded-"+this.coursenum)},this.setLearningStyle=e=>{this.learningStyle=e},this.setConciseness=e=>{this.conciseness=e},this.setLanguage=e=>{this.language=e},this.setQuizPreference=e=>{this.quizPreference=e},this.setProcessing=e=>{this.processing=e,this.setState({renderCounter:n()})},this.addIntroduction=()=>{if(this.firstUsage){this.firstUsage=!1;let e=[];this.page_id&&"coverpage"!==this.page_id&&(e=[{sendText:"Can you explain the key concepts from this section in your own words?",displayText:"Explain Key Concepts"},{sendText:"Can you provide a real-world example or application of this concept?",displayText:"Real-World Example"},{sendText:"Can you quiz me on this page to test my understanding?",displayText:"Practice Questions"},{sendText:"Can you suggest further reading or resources to explore this topic in more depth?",displayText:"Further Resources"}]),localStorage.setItem("botInitialUsage-"+this.coursenum,"false"),this.msgs.push({role:"user",content:"/Introduction"}),this.setState({renderCounter:n()}),this.setProcessing(!0),setTimeout((()=>{this.msgs.push({role:"assistant",content:'ðŸ“š Hi! I\'m your AI Virtual Assistant, here to help with your MyEducator textbook.\nI can:\n\n* Clarify concepts and provide examples\n* Help you practice with exercises and quizzes\n* Summarize pages to save time\n\nðŸ’¡ Look for purple sparkles `âœ¨` for chat suggestions!\nNote: I can\'t answer assessment questions, but I\'m here to guide your learning. Try asking things like:\n\n* "What does the textbook say about [topic]?"\n* "Can you give an example of [concept]?"\n* "Can you quiz me on [concept]?"\n* "Can you summarize this page?"',actions:e}),this.setProcessing(!1)}),1500)}},this.toggleWindowDisplay=()=>{this.addIntroduction(),this.setState((e=>({displayWin:!e.displayWin}))),localStorage.setItem("chatDisplayWin-"+this.coursenum,!this.state.displayWin)},this.expandWindow=()=>{this.setState((e=>({expanded:!0}))),localStorage.setItem("chatExpanded-"+this.coursenum,"true")},this.compressWindow=()=>{this.setState((e=>({expanded:!1}))),localStorage.setItem("chatExpanded-"+this.coursenum,"false")},this.toggleSettingsDisplay=()=>{this.state.displaySettings||this.state.displayFeedback?this.setState((e=>({displaySettings:!1,displayFeedback:!1}))):this.setState((e=>({displaySettings:!0})))},this.submitFeedback=async(e,s)=>{this.processing=!0;const t=i("notion","v1");let a=this.msgs.slice(-4).map((e=>["",`${e.role}:`,e.content,""].join("\n"))).join("\n");const n={sentiment:e,description:s,product:"chatbot",additional_details:JSON.stringify(a).slice(-2e3)};try{await t.post({path:"feedback",data:n}),this.processing=!1}catch(l){A.error("Feedback submission failed:",l)(),this.processing=!1}},this.toggleFeedbackWindow=e=>{this.setState((s=>({feedback:e,displayFeedback:!s.displayFeedback})))},this.clearMessages=()=>{this.msgs=[],this.suggestions=[],localStorage.removeItem("chatMessages-"+this.coursenum);for(let e in localStorage)e.startsWith("selectedAnswer_")&&localStorage.removeItem(e);this.setState({renderCounter:n()})},this.handleQuizAnswer=(e,s,t,a)=>{this.processing=!0,this.setState({renderCounter:n()}),void 0===a&&(a=[{sendText:"quiz",displayText:"Ask Another Question"}]),setTimeout((()=>{let i="That is incorrect. ";this.msgs.push({role:"user",content:e}),s?(i="That is correct! ",a.push({sendText:"Can you explain why my answer is correct and provide more details to help me understand the topic better?",displayText:"Why is my answer correct"})):a.push({sendText:"Can you explain to me why I got that question wrong?",displayText:"Explain why I got it wrong"}),this.msgs.push({role:"assistant",content:i+t,actions:a}),this.processing=!1;const l=this.msgs.slice(-20);localStorage.setItem("chatMessages-"+this.coursenum,JSON.stringify(l)),this.setState({renderCounter:n()})}),3e3)},this.handleNewMsg=async e=>{this.processing=!0;const s=i("aichat","v1");let t;this.suggestions=[],this.setState({renderCounter:n()});const a={messages:this.msgs,user_input:e,learning_style:this.learningStyle,conciseness:this.conciseness,language:this.language||"English",page_id:this.page_id,quiz_type:this.quizPreference,message_type:this.messageType,user_id:this.user_id};this.msgs.push({role:"user",content:e});let l=0;let o=500;const r=async()=>{try{let e={path:`chatbot/${this.coursenum}`,data:a};t=await s.post(e);let i=[];t.data.messages.forEach((e=>{"assistant"!==e.role&&"user"!==e.role||i.push(e),"assistant"===e.role&&(this.messageType=e.type||"chat")})),this.msgs=i,this.suggestions=t.data.suggestions||[];const l=this.msgs.slice(-20);localStorage.setItem("chatMessages-"+this.coursenum,JSON.stringify(l)),this.processing=!1,this.setState({renderCounter:n()})}catch(e){A.error("Post attempt failed:",e)(),l<5?(await new Promise((e=>setTimeout(e,o))),l+=1,o*=2,r()):(A.error("All retries failed.")(),this.processing=!1,this.setState({renderCounter:n()}))}};r()}}componentDidMount(){const e=localStorage.getItem("chatMessages-"+this.coursenum);e&&(this.msgs=JSON.parse(e));const s=localStorage.getItem("botInitialUsage-"+this.coursenum);s&&(this.firstUsage=JSON.parse(s)),this.setState({renderCounter:n()}),window.addEventListener("aichat-messages-updated",(e=>{if(e.detail.coursenum===this.coursenum){const e=localStorage.getItem("chatMessages-"+this.coursenum);e&&(this.msgs=JSON.parse(e),this.state.displayWin||(this.setState({displayWin:!0}),localStorage.setItem("chatDisplayWin-"+this.coursenum,"true")),this.setState({renderCounter:n()}))}}))}componentWillUnmount(){window.removeEventListener("aichat-messages-updated",this.handleMessagesUpdated)}render(){return j.jsx(L.Provider,{value:{instance:this},children:this.props.children})}}),W={en:{FnfezUqXGjMI:[{type:0,value:"across the "},{type:1,value:"subs"},{type:0,value:" most recent "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:"."}],Vn6sjvEwHkZK:[{type:1,value:"count"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"record"}]},other:{value:[{type:0,value:"records"}]}},pluralType:"cardinal",type:6,value:"count"},{type:0,value:"."}],Vrh8f2BVOLwy:[{type:0,value:"Search"}],"admin.pages.search.form.placeholder":[{type:0,value:"Search"}],c_3Gzhj7KLHI:[{type:1,value:"subs"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:" allowed."}],"epoch.duration.days":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"day"}]},other:{value:[{type:0,value:"days"}]},two:{value:[{type:0,value:"days"}]},zero:{value:[{type:0,value:"days"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.hours":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"hour"}]},other:{value:[{type:0,value:"hours"}]},two:{value:[{type:0,value:"hours"}]},zero:{value:[{type:0,value:"hours"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.millis":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"millisecond"}]},other:{value:[{type:0,value:"milliseconds"}]},two:{value:[{type:0,value:"milliseconds"}]},zero:{value:[{type:0,value:"milliseconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.minutes":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"minute"}]},other:{value:[{type:0,value:"minutes"}]},two:{value:[{type:0,value:"minutes"}]},zero:{value:[{type:0,value:"minutes"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.seconds":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"second"}]},other:{value:[{type:0,value:"seconds"}]},two:{value:[{type:0,value:"seconds"}]},zero:{value:[{type:0,value:"seconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.weeks":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"week"}]},other:{value:[{type:0,value:"weeks"}]},two:{value:[{type:0,value:"weeks"}]},zero:{value:[{type:0,value:"weeks"}]}},pluralType:"cardinal",type:6,value:"num"}],fkUMsTGn8rzM:[{type:0,value:"asdfasdf"}],"reader.pages.index.noauth":[{type:0,value:"Not authenticated: please launch from your LMS."}]},es:{FnfezUqXGjMI:[{type:0,value:"across the "},{type:1,value:"subs"},{type:0,value:" most recent "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:"."}],Vn6sjvEwHkZK:[{type:1,value:"count"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"record"}]},other:{value:[{type:0,value:"records"}]}},pluralType:"cardinal",type:6,value:"count"},{type:0,value:"."}],Vrh8f2BVOLwy:[{type:0,value:"Search"}],"admin.pages.search.form.placeholder":[{type:0,value:"Search"}],c_3Gzhj7KLHI:[{type:1,value:"subs"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:" allowed."}],"epoch.duration.days":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"day"}]},other:{value:[{type:0,value:"days"}]},two:{value:[{type:0,value:"days"}]},zero:{value:[{type:0,value:"days"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.hours":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"hour"}]},other:{value:[{type:0,value:"hours"}]},two:{value:[{type:0,value:"hours"}]},zero:{value:[{type:0,value:"hours"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.millis":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"millisecond"}]},other:{value:[{type:0,value:"milliseconds"}]},two:{value:[{type:0,value:"milliseconds"}]},zero:{value:[{type:0,value:"milliseconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.minutes":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"minute"}]},other:{value:[{type:0,value:"minutes"}]},two:{value:[{type:0,value:"minutes"}]},zero:{value:[{type:0,value:"minutes"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.seconds":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"second"}]},other:{value:[{type:0,value:"seconds"}]},two:{value:[{type:0,value:"seconds"}]},zero:{value:[{type:0,value:"seconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.weeks":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"week"}]},other:{value:[{type:0,value:"weeks"}]},two:{value:[{type:0,value:"weeks"}]},zero:{value:[{type:0,value:"weeks"}]}},pluralType:"cardinal",type:6,value:"num"}],fkUMsTGn8rzM:[{type:0,value:"Not authenticated: please launch from your LMS."}],"reader.pages.index.noauth":[{type:0,value:"Not authenticated: please launch from your LMS."}]}};function F(e){const s=_(),[t,a]=w.useState(null),[n,i]=w.useState("");w.useEffect((()=>{s.state.feedback&&a(s.state.feedback)}),[s.state.feedback]);const o=e=>()=>a(e);return j.jsxs("div",{className:"chat-feedback",children:[j.jsx("h2",{children:"Feedback"}),j.jsxs("div",{className:"feedback-icons",children:[j.jsx(S,{onClick:o("positive"),className:"rounded-circle "+("positive"===t?"active positive":""),"aria-label":"positive feedback",children:j.jsx(l,{icon:"fa-thumbs-up",solid:!0})}),j.jsx(S,{onClick:o("neutral"),className:"rounded-circle "+("neutral"===t?"active neutral":""),"aria-label":"neutral feedback",children:j.jsx(l,{icon:"fa-meh",solid:!0})}),j.jsx(S,{onClick:o("negative"),className:"rounded-circle "+("negative"===t?"active negative":""),"aria-label":"negative feedback",children:j.jsx(l,{icon:"fa-thumbs-down",solid:!0})})]}),j.jsx("textarea",{value:n,onChange:e=>i(e.target.value),placeholder:"Tell us more...",className:"feedback-description"}),j.jsx(S,{onClick:e=>{e.preventDefault(),s.submitFeedback(t,n).then((()=>{i(""),a(null),s.toggleFeedbackWindow(null)}))},className:"submit-btn",disabled:s.processing,children:"Submit Feedback"})]})}function q(){const e=_(),s=()=>{e.toggleSettingsDisplay()};return j.jsxs(N.Header,{className:"d-flex align-items-center",style:{padding:"10px"},children:[j.jsx(N.Title,{className:"flex-maximal text-capitalize",children:"Virtual Assistant"}),j.jsxs("div",{className:"flex-minimal d-flex",children:[e.state.displaySettings||e.state.displayFeedback?j.jsxs(S,{variant:"gray-tertiary",onClick:s,className:"flex-minimal","aria-label":"go back to chat",title:"Back to chat",children:[j.jsx(l,{icon:"fa-arrow-left",className:"icon",solid:!0}),j.jsx("p",{className:"icon-label",children:"Back"})]}):j.jsxs(j.Fragment,{children:[j.jsx("span",{className:"icon-container",children:j.jsxs(S,{variant:"gray-tertiary",onClick:()=>{e.clearMessages()},className:"flex-minimal icon-button","aria-label":"clear chat history",title:"Clear chat history",children:[j.jsx(l,{icon:"fa-undo",className:"icon",solid:!0}),j.jsx("p",{className:"icon-label",children:"Clear"})]})}),j.jsx("span",{className:"icon-container",children:j.jsxs(S,{variant:"gray-tertiary",onClick:s,className:"flex-minimal","aria-label":"open language and learning style settings",title:"Language and learning style settings",children:[j.jsx(l,{icon:"fa-cog",className:"icon",solid:!0}),j.jsx("p",{className:"icon-label",children:"Settings"})]})})]}),j.jsx("span",{className:"icon-container expand-button full-screen-button-hidden",children:j.jsxs(S,{variant:"gray-tertiary",onClick:e.state.expanded?()=>{e.compressWindow()}:()=>{e.expandWindow()},className:"flex-minimal","aria-label":e.state.expanded?"Shrink chat window":"Expand chat window",title:e.state.expanded?"Shrink the chatbot":"Expand the chatbot",children:[j.jsx(l,{icon:e.state.expanded?"faCompressAlt":"faExpandAlt",className:"icon",size:"2x"}),j.jsx("p",{className:"icon-label",children:e.state.expanded?"Shrink":"Expand"})]})}),j.jsx("span",{className:"icon-container full-screen-button-hidden",children:j.jsxs(S,{variant:"gray-tertiary",onClick:()=>{e.toggleWindowDisplay()},className:"flex-minimal","aria-label":"close chat window",title:"Close the chat window",children:[j.jsx(l,{icon:"faTimes",className:"icon",size:"2x"}),j.jsx("p",{className:"icon-label",children:"Close"})]})})]})]})}const O=e("useSpeechRecognition"),D=()=>{const[e,s]=w.useState(""),[t,a]=w.useState(!1),[n,i]=w.useState(!1),l=w.useRef(null);w.useEffect((()=>{const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(e)return i(!0),l.current=new e,l.current.continuous=!0,l.current.lang="en-US",l.current.onresult=e=>{const t=e.results[e.resultIndex][0].transcript;s(t)},l.current.onerror=e=>{O.error(e)(),l.current.stop(),a(!1)},()=>{l.current&&l.current.stop()};i(!1)}),[]);return{text:e,isListening:t,startListening:()=>{s(""),l.current&&(l.current.start(),a(!0))},stopListening:()=>{l.current&&(l.current.stop(),a(!1))},hasSpeechRecognition:n}},R=e("ai-chat");function V(e){const s=_(),{text:t,isListening:a,startListening:n,stopListening:i,hasSpeechRecognition:u}=D(),d=f.useRef(),p=f.useRef(),[h,m]=f.useState(0),g=[{label:"/summarize",action:()=>s.handleNewMsg("/summarize")},{label:"/translate",action:()=>s.handleNewMsg("/translate")},{label:"/explain in more details",action:()=>s.handleNewMsg("/details")},{label:"/explain in simple terms",action:()=>s.handleNewMsg("/simplify")},{label:"/quiz",action:()=>s.handleNewMsg("/quiz")}],[v,y]=f.useState(!1),[x,b]=f.useState(g),N=e=>{x[e].action(),y(!1),p.current.setFieldValue("text","")},E=f.useMemo((()=>o({onKeyDown_Enter:e=>{if(!s.processing)if(v){e.preventDefault();x[h].action(),y(!1),p.current.setFieldValue("text","")}else e.defaultPrevented||(e.preventDefault(),p.current.submitForm())},onKeyDown_ArrowDown:e=>{e.preventDefault(),m((e=>(e+1)%x.length))},onKeyDown_ArrowUp:e=>{e.preventDefault(),m((e=>(e-1+x.length)%x.length))}})),[x,h,v]),T=e=>{const{value:s}=e.target;if(s.startsWith("/")){y(!0);const e=s.slice(1).toLowerCase();b(g.filter((s=>s.label.toLowerCase().includes(e))))}else y(!1)};return w.useEffect((()=>{if(t){const e=p.current.values.text+t;p.current.setFieldValue("text",e)}}),[t]),j.jsx(k,{validateOnChange:!1,validateOnBlur:!1,initialValues:{text:""},innerRef:p,onSubmit:async(e,t)=>{let a=e.text;t.resetForm({values:{text:""}}),i();try{await s.handleNewMsg(a)}catch(n){R.error(n)()}setTimeout((()=>{var e;null==(e=d.current)||e.focus()}),25)},children:e=>j.jsx(C,{onSubmit:e.handleSubmit,children:j.jsxs("div",{className:"d-flex inputContainer align-items-center",children:[j.jsxs("div",{className:"flex-maximal",children:[j.jsx("div",{className:"command-menu",style:{display:v?"block":"none"},children:x.map(((e,s)=>j.jsx("div",{onClick:()=>{N(s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||N(s)},tabIndex:0,onMouseEnter:()=>(e=>{m(e)})(s),role:"button",className:"command-item "+(s===h?"selected":""),"aria-label":e.label,children:e.label},s)))}),j.jsx(r,{className:"border-0 input-box",ref:d,as:c,name:"text",placeholder:"Ask your question here...",autoComplete:"off",autoFocus:!0,onKeyDown:E,onChange:T,"aria-label":"ai chat input",style:{resize:"none"}})]}),j.jsxs("div",{className:"flex-minimal",children:[u&&j.jsxs("span",{className:"listening-button",children:[j.jsx(S,{className:"flex-minimal mic-button "+(a?"listening":""),onClick:a?i:n,"aria-label":a?"Stop using microphone":"Use microphone",disabled:s.processing,children:j.jsx(l,{icon:"faMicrophone",weight:"solid","aria-hidden":"true"})}),a&&j.jsx("p",{className:"listening-text",children:"Speak now..."})]}),j.jsx(S,{className:"flex-minimal submitChat",type:"submit",disabled:""===e.values.text.trim()||s.processing,"aria-label":"Submit your question",children:j.jsx(l,{icon:"faPaperPlane",weight:"solid","aria-hidden":"true"})})]})]})})})}const U=({msg:e,isLastMessage:s,answerQuizQuestion:t})=>{let a=_();const[n,i]=w.useState(null);w.useEffect((()=>{const s=localStorage.getItem(`selectedAnswer_${e.id}`);null!==s&&i(parseInt(s,10))}),[e.id]);return j.jsxs("div",{className:"quiz",children:[e.answers.map(((o,r)=>j.jsxs("div",{className:"quiz-answer "+(null!==n?e.correct_answer===r?"correct":n===r?"incorrect":"":""),children:[j.jsxs("div",{className:"checkbox-container",children:[j.jsx("input",{type:"checkbox",disabled:!s||a.processing,checked:n===r,onChange:()=>((s,a,n,l)=>{i(a);const o=e.correct_answer===a;t(s,o,n,l),localStorage.setItem(`selectedAnswer_${e.id}`,a)})(o,r,e.explanation,e.actions),id:`answer-${r}`,className:"custom-checkbox"}),null!==n&&(e.correct_answer===r?j.jsx(l,{icon:"faCheck",className:"icon-correct"}):n===r&&j.jsx(l,{icon:"faTimes",className:"icon-incorrect"}))]}),j.jsx("label",{className:"quiz-answer-label",htmlFor:`answer-${r}`,children:o})]},r))),null!=n&&j.jsx("div",{className:"quiz-feedback-container",children:e.correct_answer===n?j.jsxs("p",{className:"correct quiz-feedback",children:[j.jsx(l,{icon:"faCheck",className:"icon-answer-feedback"}),"You answered correctly!"]}):j.jsxs("p",{className:"incorrect quiz-feedback",children:[j.jsx(l,{icon:"faTimes",className:"icon-answer-feedback"}),"You answered incorrectly."]})})]})},G=({inline:e,className:s,children:t,...a})=>{const n=w.useRef(null);return w.useEffect((()=>{!e&&s&&n.current&&M.highlightElement(n.current)}),[s,t,e]),j.jsx("code",{ref:n,className:s,...a,children:t})},H=e("ai-chat");function Q(e){let s=_(),t=s.msgs;const[a,n]=w.useState(null),[i,o]=w.useState(!1),r=w.useRef(null);w.useEffect((()=>{(async()=>{try{const e=await u();n(e)}catch(e){console.error("Error loading markdown modules:",e)}})()}),[]);w.useEffect((()=>{var e;null==(e=r.current)||e.scrollIntoView({behavior:"smooth"})}),[t,s.state.aiToolsExpanded]),w.useEffect((()=>{M.highlightAll()}),[t]);const c=()=>{navigator.clipboard.writeText(t[t.length-1].content),o(!0),setTimeout((()=>{o(!1)}),3e3)},d=async()=>{const e=t.findLast((e=>"user"===e.role));if(!e)return void console.log("No user message found.");const a=e.content.includes("Please try answering this again:")?e.content:"Please try answering this again: "+e.content;try{await s.handleNewMsg(a)}catch(n){H.error(n)()}},p=e=>()=>{s.toggleFeedbackWindow(e)},h=(e,t,a,n)=>{s.handleQuizAnswer(e,t,a,n)},m=e=>{s.handleNewMsg(e)},g=({action:e,sendMessage:t})=>j.jsxs("button",{disabled:s.processing,className:"action-button",onClick:()=>t("/"+e.sendText),children:[j.jsx(l,{solid:!0,icon:"faSparkles",style:{marginRight:"5px"},disabled:s.processing}),e.displayText]});return j.jsxs("div",{className:"chatMessages",children:[t.map(((e,n)=>{const o=n===t.length-1;return"string"==typeof e.content?"user"===e.role?j.jsx("div",{className:"userMsgContainer",children:j.jsx("div",{className:"chatMessage user mx-0p3 "+(e.content.startsWith("/")?"aiUserMessage":""),children:j.jsxs("span",{children:[e.content.startsWith("/")&&j.jsx(l,{className:"faSparkles "+(o&&s.processing?"ai-sparkles":""),solid:!0,icon:"faSparkles",style:{marginRight:"5px"},disabled:s.processing}),e.content.replace("/","").charAt(0).toUpperCase()+e.content.replace("/","").slice(1)]})})},n):j.jsxs("div",{className:"botMsgContainer",children:[j.jsx("div",{className:"messageTag",children:"Virtual Assistant"}),j.jsxs("div",{className:"chatMessage bot mx-0p3",children:[a?j.jsx(a.Markdown,{remarkPlugins:[a.remarkGfm,a.remarkMath],rehypePlugins:[a.rehypeKatex],components:{code:G,p:({children:e})=>j.jsx("span",{children:e}),li:({children:e})=>j.jsx("li",{children:e}),ul:({children:e})=>j.jsx("ul",{children:e}),ol:({children:e})=>j.jsx("ol",{children:e}),thead:({children:e})=>j.jsx("thead",{children:e}),tbody:({children:e})=>j.jsx("tbody",{children:e}),tr:({children:e})=>j.jsx("tr",{children:e}),th:({children:e})=>j.jsx("th",{children:e}),td:({children:e})=>j.jsx("td",{children:e})},children:e.content}):j.jsx("div",{children:"Loading markdown..."}),e.quiz&&e.answers&&j.jsx(U,{msg:e,isLastMessage:o,answerQuizQuestion:h}),j.jsx("div",{className:"action-button-container",children:e.actions&&!e.quiz&&e.actions.map(((e,s)=>j.jsx(g,{action:e,sendMessage:m},s)))})]}),o&&j.jsxs("div",{ref:r,className:"feedbackMessage",children:[j.jsx("span",{children:j.jsx(S,{variant:"gray-tertiary",onClick:d,className:"message-actions",style:{padding:"2px"},"aria-label":"Retry",title:"Try again",children:j.jsxs("span",{className:"icon-container",children:[j.jsx(l,{icon:"fa-repeat",className:"feedback-icons",regular:!0}),j.jsx("span",{className:"icon-label",children:"Retry"})]})})}),j.jsx("span",{children:j.jsx(S,{variant:"gray-tertiary",onClick:c,className:"message-actions",style:{padding:"2px"},"aria-label":"Copy text",title:i?"Copied!":"Copy Text",children:j.jsxs("span",{className:"icon-container",children:[j.jsx(l,{icon:i?"fa-check":"fa-copy",className:"feedback-icons",regular:!0}),j.jsx("span",{className:"icon-label",children:i?"Copied!":"Copy"})]})})}),j.jsx("span",{children:j.jsx(S,{variant:"gray-tertiary",onClick:p("positive"),className:"message-actions",style:{padding:"2px"},"aria-label":"positive feedback",title:"Positive Feedback",children:j.jsxs("span",{className:"icon-container",children:[j.jsx(l,{icon:"fa-thumbs-up",className:"feedback-icons",regular:!0}),j.jsx("span",{className:"icon-label",children:"Positive Feedback"})]})})}),j.jsx("span",{children:j.jsx(S,{variant:"gray-tertiary",onClick:p("negative"),className:"message-actions",style:{padding:"2px"},"aria-label":"negative feedback",title:"Negative Feedback",children:j.jsxs("span",{className:"icon-container",children:[j.jsx(l,{icon:"fa-thumbs-down",className:"feedback-icons",regular:!0}),j.jsx("span",{className:"icon-label",children:"Negative Feedback"})]})})})]})]},n):null})),j.jsx(B,{}),s.processing&&j.jsx(K,{})]})}const B=()=>{const e=w.useRef();return w.useEffect((()=>e.current.scrollIntoView())),j.jsx("div",{ref:e})},K=e=>{const s=["Analyzing your question...","Scanning textbook chapters...","Pulling appropriate context...","Evaluating context...","Formulating response...","Generating response...","Hold tight, almost there...","Generating response...","Almost done...","Turning Shrek back into an Ogre..."],[t,a]=w.useState(0);return w.useEffect((()=>{const e=setInterval((()=>{a((e=>(e+1)%s.length))}),3e3);return()=>clearInterval(e)}),[]),j.jsxs("div",{children:[j.jsx("div",{className:"messageTag",children:"Virtual Assistant"}),j.jsxs("div",{className:"bouncing-loader d-flex pb-1",children:[j.jsx("div",{}),j.jsx("div",{}),j.jsx("div",{})]}),j.jsx("div",{className:"status-message",children:s[t]})]})};function $(e){const s=_(),[t,a]=w.useState(localStorage.getItem("botConciseness-"+s.coursenum)||"normal"),[n,i]=w.useState(localStorage.getItem("botLearningStyle-"+s.coursenum)||"default"),[l,o]=w.useState(localStorage.getItem("botLanguage-"+s.coursenum)||"english"),[r,c]=w.useState(localStorage.getItem("botQuizPreference-"+s.coursenum)||"multiple-choice");w.useEffect((()=>{localStorage.setItem("botConciseness-"+s.coursenum,t),s.setConciseness(t)}),[t]),w.useEffect((()=>{localStorage.setItem("botLearningStyle-"+s.coursenum,n),s.setLearningStyle(n)}),[n]),w.useEffect((()=>{localStorage.setItem("botLanguage-"+s.coursenum,l),s.setLanguage(l)}),[l]),w.useEffect((()=>{localStorage.setItem("botQuizPreference-"+s.coursenum,r),s.setQuizPreference(r)}),[r]);const u=e=>{i(e.target.value)};return j.jsxs("div",{className:"chatSettings",children:[j.jsx("h2",{children:"Settings"}),j.jsxs("div",{className:"setting",children:[j.jsx("label",{htmlFor:"language",children:"Response Language"}),j.jsxs("select",{id:"language",value:l,onChange:e=>{o(e.target.value)},children:[j.jsx("option",{value:"English",children:"English"}),j.jsx("option",{value:"Spanish",children:"Spanish"}),j.jsx("option",{value:"German",children:"German"}),j.jsx("option",{value:"French",children:"French"}),j.jsx("option",{value:"Italian",children:"Italian"}),j.jsx("option",{value:"Portuguese",children:"Portuguese"}),j.jsx("option",{value:"Japanese",children:"Japanese"}),j.jsx("option",{value:"Tagalog",children:"Tagalog"})]})]}),j.jsxs("div",{className:"setting",children:[j.jsx("label",{htmlFor:"quiz",children:"Quiz Preferences:"}),j.jsxs("select",{id:"quiz",value:r,onChange:e=>{c(e.target.value)},children:[j.jsx("option",{value:"multiple-choice",children:"Multiple-Choice"}),j.jsx("option",{value:"short-answer",children:"Open-Ended"})]})]}),j.jsxs("div",{className:"setting",children:[j.jsx("label",{htmlFor:"conciseness",children:"Response Conciseness:"}),j.jsxs("select",{id:"conciseness",value:t,onChange:e=>{a(e.target.value)},children:[j.jsx("option",{value:"concise",children:"Concise"}),j.jsx("option",{value:"default",children:"Default"}),j.jsx("option",{value:"detailed",children:"Detailed"})]})]}),j.jsxs("div",{className:"setting",children:[j.jsx("label",{htmlFor:"learningStyle",children:"Learning Style:"}),j.jsxs("div",{className:"learningStyleOptions",id:"learningStyle",children:[j.jsxs("label",{children:[j.jsx("input",{type:"checkbox",value:"default",checked:n.includes("default"),onChange:u}),"Default",j.jsx("span",{className:"description",children:"Balanced mix of learning styles"})]}),j.jsxs("label",{children:[j.jsx("input",{type:"checkbox",value:"practical",checked:n.includes("practical"),onChange:u}),"Practical",j.jsx("span",{className:"description",children:"Emphasis on practical applications and real-world examples"})]}),j.jsxs("label",{children:[j.jsx("input",{type:"checkbox",value:"questioning",checked:n.includes("questioning"),onChange:u}),"Questioning",j.jsx("span",{className:"description",children:"Encourages critical thinking and reflection through questions"})]}),j.jsxs("label",{children:[j.jsx("input",{type:"checkbox",value:"structured",checked:n.includes("structured"),onChange:u}),"Structured",j.jsx("span",{className:"description",children:"Presents information in logical sequence, in well-structured manner"})]})]})]})]})}function J(e){let s=_();const t=f.useRef(null),[a,n]=f.useState(s.suggestions||[]),[i,o]=f.useState(!1),[r,c]=f.useState(!0),u=e=>{for(let s=e.length-1;s>0;s--){const t=Math.floor(Math.random()*(s+1));[e[s],e[t]]=[e[t],e[s]]}return e};f.useEffect((()=>{c(!0);const e=[];s.page_id&&0===e.length&&"coverpage"!==s.page_id&&(e.push("/Summarize page"),e.push("/Quiz me on this page"),"english"!==s.language.toLowerCase()&&e.push("/Translate page"));const t=[...s.suggestions,...e];t.sort(((e,s)=>s.length-e.length));const[a,i,l]=(e=>{let s=0,t=0,a=0;const n=[],i=[],l=[];return e.length>=5?e.forEach((e=>{s<=t&&s<=a?(n.push(e),s+=e.length):t<=s&&t<=a?(i.push(e),t+=e.length):(l.push(e),a+=e.length)})):e.length<=2?n.push(...e):e.forEach((e=>{s<=t?(n.push(e),s+=e.length):(i.push(e),t+=e.length)})),n.length>1&&u(n),i.length>1&&u(i),l.length>1&&u(l),[n,i,l].filter((e=>e.length>0))})(t);n([a,i,l]),c(!1)}),[s.suggestions,s.state.expanded]);return a&&a.length>0?j.jsx("div",{className:"suggestions-wrapper-wrapper",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onWheel:e=>{if(i){const s=5*e.deltaY;t.current.scrollLeft+=s}},ref:t,children:j.jsx("div",{className:"suggestion-wrapper",children:r?j.jsx("div",{children:"Loading suggestions..."}):Array.isArray(a)&&a.map(((e,t)=>j.jsx("div",{className:"suggestion-row",children:null==e?void 0:e.map(((e,t)=>j.jsxs("button",{className:"suggestion "+(e.startsWith("/")?"aiButton":""),onClick:()=>{return t=e,void s.handleNewMsg(t);var t},disabled:s.processing,children:[e.startsWith("/")&&j.jsx(l,{solid:!0,icon:"faSparkles",style:{marginRight:"5px"},disabled:s.processing}),e.replace("/","")]},t)))},t)))})}):null}function X(e){const t=_(),[a,n]=w.useState((()=>{const e=localStorage.getItem("chatWindowWidth"),s=e?parseInt(e,10):450;return Math.max(300,s)})),[i,o]=w.useState(window.innerWidth>800),r=!t.state.displaySettings&&!t.state.displayFeedback;w.useEffect((()=>{null!==a&&localStorage.setItem("chatWindowWidth",a)}),[a]),w.useEffect((()=>{const e=()=>{o(window.innerWidth>800),.8*window.innerWidth<a&&n(.8*window.innerWidth)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}}),[a]),w.useEffect((()=>{window.innerWidth<800&&t.expandWindow()}),[]);const c=w.useCallback((e=>{e.preventDefault();const s="touchstart"===e.type,t=s?e.touches[0].clientX:e.pageX,i=a;function l(e){e.preventDefault();const a=s?e.touches[0].clientX:e.pageX,l=i-(a-t),o=Math.max(300,Math.min(l,.8*window.innerWidth));n(o)}document.body.classList.add("resizing"),document.body.addEventListener(s?"touchmove":"mousemove",l),document.body.addEventListener(s?"touchend":"mouseup",(function e(){document.body.removeEventListener(s?"touchmove":"mousemove",l),document.body.removeEventListener(s?"touchend":"mouseup",e),document.body.classList.remove("resizing")}))}),[a]),u=(()=>{let e=t.full_page?"full-page":t.state.expanded?"expanded":"";return a<350&&(e+=" baby-sized"),e.trim()})(),d=!(t.state.expanded&&t.state.displayWin);return j.jsxs("div",{children:[t.state.displayWin&&j.jsx("div",{className:`aiChat ${u}`,style:t.state.expanded&&i?{width:`${a}px`,bottom:0,right:0}:{},children:j.jsxs(N,{className:`aiChatWindow ${u}`,children:[t.state.expanded&&j.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)"},className:"resize-handle",onMouseDown:c,onTouchStart:c,tabIndex:0,role:"button","aria-label":"Resize chat window",children:j.jsx(l,{icon:"fa-grip-lines-vertical",className:"icon",solid:!0})}),j.jsx(q,{}),j.jsx(N.Body,{className:"msgSection border-top p-0",children:t.state.displaySettings?j.jsx($,{}):t.state.displayFeedback?j.jsx(F,{}):j.jsx(Q,{})}),r&&j.jsxs(N.Footer,{className:"border-top p-0 footerDetails",children:[j.jsx(J,{}),j.jsx(V,{})]})]})}),j.jsx("div",{className:"aiChatToggleWrapper",style:{display:d?"block":"none"},children:j.jsxs("button",{className:"d-flex justify-content-end aiChatButton",onClick:()=>t.toggleWindowDisplay(),onKeyDown:e=>{"Enter"===e.key&&t.toggleWindowDisplay()},"aria-label":"virtual assistant",children:[j.jsx("img",{src:`${s.VOSHI_STATIC_URL}/media/images/aichat/100px.png`,className:"aiChatToggle",alt:"Virtual Assistant"}),j.jsx(l,{icon:"fa-sparkles",className:"sparkles-icon "+(t.firstUsage?"first-usage":""),solid:!0})]})})]})}function Y(){return j.jsxs(E,{children:[j.jsx(T,{path:"/",children:j.jsx(X,{})}),j.jsx(T,{children:j.jsx(d,{className:"my-2 text-center",message:"This page has left the building [invalid or unknown path]."})})]})}x.setOptions({strict:!1});const Z=class extends p{};Z.ELEMENT_NAME="AiChatElement",Z.ELEMENT_TAG=`vapp-${s.VOSHI_APP}`,Z.REACT_COMPONENT=function({webcomp:e,...t}){const a=e.isStandalone?I:z,n=e.config.coursenum||e.getAttribute("coursenum");return j.jsx(h,{messages:W,children:j.jsx(a,{basename:s.VOSHI_APP_PATH,initialIndex:0,initialEntries:[e.config.path||"/"],children:j.jsx(m,{initializing:j.jsx(g,{className:"my-4"}),children:()=>j.jsx(v,{featureKey:"aichat",coursenum:n,children:j.jsx(y,{children:j.jsx(P,{webcomp:e,userid:e.config.userid||e.getAttribute("userid"),coursenum:n,pageid:e.config.pageid||e.getAttribute("pageid"),children:j.jsx(Y,{})})})})})})})},Z.CONFIG={...p.CONFIG,userid:void 0,coursenum:void 0,pageid:void 0,question:void 0,questionType:void 0,answer:void 0,correctAnswer:void 0},Z.ATTRIBUTES={...p.ATTRIBUTES,userid:void 0,coursenum:void 0,pageid:void 0,question:void 0,questionType:void 0,answer:void 0,correctAnswer:void 0},function(a){const n=e("voshi");try{if(!s.VOSHI_APP)throw new Error("environment is missing VOSHI_APP");if(!s.VOSHI_STAGE)throw new Error("environment is missing VOSHI_STAGE");if(!s.VOSHI_BUILD)throw new Error("environment is missing VOSHI_BUILD");if(!s.VOSHI_PLATFORM)throw new Error("environment is missing VOSHI_PLATFORM");n.force("welcome to {}",s.appsig)(),s.appsig!==t.appsig&&n.force("built as {}",t.appsig)(),customElements.get(a.ELEMENT_TAG)?n.info(`custom element already defined for <${a.ELEMENT_TAG}>`)():(n.info(`defining custom element ${a.ELEMENT_NAME} for <${a.ELEMENT_TAG}>`)(),customElements.define(a.ELEMENT_TAG,a))}catch(i){n.error("Error loading app",i)()}}(Z);
