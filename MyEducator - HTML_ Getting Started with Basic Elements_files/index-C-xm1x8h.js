import{g as e,e as t,a as o,c as s,i as a,n as i,V as r,E as n,B as l,b as u,s as p,d,f as c,N as h,F as m,h as v,j as y,T as f,I as g,k as x,u as w,l as b,m as T,P as E,o as N,r as _,p as j,q as k,L as M,A as S,t as P,M as D}from"./app-lib-hSK4Pccr.js";import{m as A,f as R,k as C}from"./vendor-base-DUek7cDh.js";import{R as V,j as L,e as O,F as I,B,f as z,P as K}from"./vendor-other-jAS9t_Tu.js";import"./vendor-xml-0NFUgpxB.js";import"./vendor-intl-D5oOls7S.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const U=V.createContext({});function $(){return V.useContext(U).instance}U.displayName="NarrateContext",s(U,"_narrate_context_wrapper_",(e=>{e.ctxapp=e._narrate_context_wrapper_.instance}));const H="Ruth",F="en-US",G=".narrate-content",q=["*[data-narrate=select]","p","li","dd","th","td","h1","h2","h3","h4","h5","h6","title","caption"],X=["*[data-narrate=ignore]","script","style","iframe","frame","embed","object","canvas","audio","video","img","svg","math"];class W{constructor(e,t,o,s,a){this.block=e,this.idx=t,this.endidx=o,this.time=s,this.endtime=a,this.runs=[]}findTextRuns(e){let t=!1,o=-1,s=e.getCurrent();for(;s&&(this.idx>=s.idx&&this.idx<s.endidx&&(t=!0),t&&(o=s.idx-s.rel,this.runs.push(new Y(s.parent,Math.max(s.rel,this.idx-o),Math.min(s.endrel,this.endidx-o)))),!(this.endidx>=s.idx&&this.endidx<=s.endidx));)s=e.getNext()}export(){return{idx:this.idx,endidx:this.endidx,time:this.time,endtime:this.endtime,runs:this.runs.map((e=>e.export()))}}}class Y{constructor(e,t,o){this.parent=e,this.rel=t,this.endrel=o}export(){return{parent:this.parent?this.parent.nodeName.toLowerCase():null,rel:this.rel,endrel:this.endrel}}}const J=/[ \t\n\r\f\v]+/g;class Z{constructor(e,t,o,s){this.s1=e,this.s2=t,this.b1=o,this.b2=s}}class Q{constructor(e,t,o,s){this.s1=e,this.s2=t,this.b1=o,this.b2=s}}function*ee(e){const t=e.length;if(0===t)return;const o=new TextEncoder;let s,a,i=0,r=0,n=0;for(const l of e.matchAll(J))s=l.index,a=s+l[0].length,i<s&&(n=r+o.encode(e.slice(i,s)).length,yield new Z(i,s,r,n),r=n),n=r+o.encode(e.slice(s,a)).length,yield new Q(s,a,r,n),r=n,i=a;i<t&&(n=r+o.encode(e.slice(i,t)).length,yield new Z(i,t,r,n))}function te(e,t){if(e.nodeType===Node.ELEMENT_NODE&&t.length>0)for(const o of t)if(e.matches(o))return!0;return!1}function oe(e){return A.blake2bHex(e,null,32)}function se(e,t){let o=e[0],s=0,a=0,i=e.length;for(;s<i;)if(a=Math.floor((s+i)/2),o=e[a],t<o.time)i=a;else{if(!(t>=o.endtime))break;s=a+1}return t<o.time||t>=o.endtime?null:o}class ae{constructor(e,t,o){this.id=null,this.narration=e,this.elem=o,this.idx=0,this.endidx=-1,this.content=null,this.runs=[],this.words=[],this.time=-1,this.endtime=-1;let s=0,i=0;const r=[];let n,l=!0;const u=new TextEncoder,p=e=>{let t=0,o=0;for(const d of a(e))if(d.nodeType!==Node.ELEMENT_NODE||te(d,this.narration.options.ignores)){if(d.nodeType===Node.TEXT_NODE){n=u.encode(d.nodeValue);for(const a of ee(d.nodeValue))a instanceof Z?(r.push(...n.subarray(a.b1,a.b2)),i=s+a.b2-a.b1,l=!1):l||(r.push(32),i=s+1,l=!0),o=t+a.b2-a.b1,s<i&&this.runs.push(new ie(s,i,e,t,o)),s=i,t=o}}else p(d)};p(o),this.content=new Uint8Array(r),this.id=R("b{:04d}-{}",t,oe(this.content)),this.endidx=i}isEmpty(){return 0===this.endidx}wordForTimestamp(e){return se(this.words,e)}integrateNarrationData(e){if(this.words.length>0)throw new Error("wordmarks were already added");this.time=e.ts,this.endtime=e.te;const t=new re(this);for(const o of e.words){const e=new W(this,o.is,o.ie,o.ts,o.te);e.findTextRuns(t),this.words.push(e)}}export(){return{id:this.id,elem:this.elem?this.elem.nodeName.toLowerCase():null,idx:this.idx,endidx:this.endidx,content:Array.from(this.content),content_:(new TextDecoder).decode(this.content),runs:this.runs.map((e=>e.export())),words:this.words.map((e=>e.export())),time:this.time,endtime:this.endtime}}}class ie{constructor(e,t,o,s,a){this.idx=e,this.endidx=t,this.parent=o,this.rel=s,this.endrel=a}export(){return{idx:this.idx,endidx:this.endidx,parent:this.parent?this.parent.nodeName.toLowerCase():null,rel:this.rel,endrel:this.endrel}}}class re{constructor(e){this.block=e,this.idx=0}getCurrent(){return this.idx<this.block.runs.length?this.block.runs[this.idx]:null}getNext(){return this.idx+=1,this.getCurrent()}}class ne{constructor(e){if(this.instanceId=i(),this.id=null,this.blocks=[],this.options={doc:self.document,root:G,selectors:q,ignores:X,voice_id:H,lang_code:F,...e},this.options.root.nodeName||(this.options.root=this.options.doc.querySelector(this.options.root)),!this.options.root)throw new r(`narration root not found: ${this.options.root}`);"string"===C(this.options.selectors)&&(this.options.selectors=[this.options.selectors]),"string"===C(this.options.ignores)&&(this.options.ignores=[this.options.ignores]);const t=e=>{if(te(e,this.options.ignores));else if(te(e,this.options.selectors)){const t=new ae(this,this.blocks.length,e);t.isEmpty()||this.blocks.push(t)}else for(const o of a(e,{type:Node.ELEMENT_NODE}))t(o)};t(this.options.root),this.id=oe(this.blocks.map((e=>e.id)).join(""))}blockForTimestamp(e){return se(this.blocks,e)}integrateNarrationData(e){for(const t of this.blocks){const o=e.blocks[t.id];o&&t.integrateNarrationData(o)}}to_ssml(){if(!this.blocks)throw new Error("blocks have not been found");const e=new TextDecoder,t=this.options.doc.implementation.createDocument(null,"speak",null),o=t.documentElement,s=n({document:t});o.appendChild(s("mark",{name:`id-${this.id}`}));for(const a of this.blocks)o.appendChild(s("p",s("mark",{name:a.id}),e.decode(a.content)));return o.appendChild(s("mark",{name:`end-${this.id}`})),t}export(){return{id:this.id,root:this.options.root?this.options.root.nodeName.toLowerCase():null,selectors:this.options.selectors,ignores:this.options.ignores,blocks:this.blocks.map((e=>e.export()))}}}const le=class extends l{};le.NAME="vapp-show-player";let ue=le;const pe=class extends l{};pe.NAME="vapp-hide-player";let de=pe;const ce=class extends l{_initialize(e,t){super._initialize(e,t),this.ssml=t.ssml}};ce.NAME="vapp-narration-processing";let he=ce;const me=class extends l{};me.NAME="vapp-player-ready";let ve=me;const ye="narrate-styles",fe="narrate-highlight",ge=`\n    <style id="${ye}">\n        .${fe} {\n            background-color: #F8E3A3;\n            border-radius: 2px;\n        }\n    </style>\n`;function xe(e){if(e)for(const t of e.querySelectorAll(`.${fe}`)){for(const e of a(t))t.parentNode.insertBefore(e,t);t.parentNode.removeChild(t)}}class we extends Error{constructor(e,...t){super(e||"Speech processing failure",...t)}}class be extends Error{constructor(e,...t){super(e||"Too many processing requests",...t)}}const Te=e("provider");class Ee extends V.PureComponent{constructor(){super(...arguments),this.narration=null,this.error=null,this.voice=null,this.lang_code=null,this.playerReady=!1,this.state={counter:i()},this.togglePlayer=(e=void 0)=>{e=void 0===e?!this.playerVisible:e,p(this.props.webcomp,"show")}}render(){return L.jsx(U.Provider,{value:{instance:this},children:this.props.children})}_setPlayerReady(e){Te.debug(e?"player ready":"player closed")(),this.playerReady=e,this.setState({counter:i()})}_setError(e){this.error=e,this.togglePlayer(!0)}get switchVisible(){return!d(this.props.webcomp,"noswitch")}get playerVisible(){return d(this.props.webcomp,"show")}resetNarration(){var e;xe(null==(e=this.narration)?void 0:e.options.root),this.narration=null,this.error=null,this.setState({counter:i()})}async initNarration(){try{Te.debug("finding narration text")();const e=new ne({root:this.props.webcomp.config.root||G,selectors:this.props.webcomp.config.selectors||q,ignores:this.props.webcomp.config.ignores||X,voice_id:this.props.webcomp.config.voice_id||H,lang_code:this.props.webcomp.config.lang_code||F});Te.debug(`found ${e.blocks.length} blocks`)(),this.setState({counter:i()}),Te.debug("downloading speech data")();const t=await this.downloadSpeech(e);if(!e)return;Te.debug("integrating word boundaries")(),e.integrateNarrationData(t),Te.debug("narration ready")(),this.narration=e,this.error=null,this.setState({counter:i()})}catch(e){Te.error(`Unable to initialize narration: ${e}`,e)(),this.narration=null,this._setError(e)}}async downloadSpeech(e,o=!0){var s;try{const o=await c({url:`${t.VOSHI_NARRATION_URL}/${e.id}.${e.options.lang_code}.${e.options.voice_id}.json`}).promise;if(null==(s=o.data.errors)?void 0:s.length){if(o.data.errors.flat().join(";").indexOf("ThrottlingException")>=0)throw new be;throw new we}return o.data}catch(n){if(!o)throw n;if(!(n instanceof h||n instanceof m||n instanceof be))throw n}Te.debug("requesting audio processing")();const a=e.to_ssml(),i=(new XMLSerializer).serializeToString(a);he.dispatch(this.props.webcomp,{ssml:i});const r=v("narrate","v1");await r.post({path:"convert",data:{ssml:i,polly_config:{voice_id:e.options.voice_id,lang_code:e.options.lang_code},meta:{title:this.props.webcomp.config["meta-title"]||"",compilation:this.props.webcomp.config["meta-compilation"]||"",publisher:this.props.webcomp.config["meta-publisher"]||"",source:this.props.webcomp.config["meta-source"]||""},overwrite:!0}});for(let t=0;t<30;t++){if(await y(2e3),!e)return;try{return await this.downloadSpeech(e,!1)}catch(n){if(!(n instanceof h||n instanceof m||n instanceof be))throw n}}throw Error("timed out")}}function Ne(e){const t=$(),o=O();return L.jsx(L.Fragment,{children:L.jsx("div",{className:"app-toggle",children:L.jsx(I.Check,{type:"switch",label:o.formatMessage({id:"4zpjnr73Lb_i",defaultMessage:[{type:0,value:"Narration:"}]}),checked:t.playerVisible,onChange:e=>{t.togglePlayer(e.target.checked)},title:o.formatMessage({id:"dod6PSv-4s2_",defaultMessage:[{type:0,value:"Click to show/hide the narration player"}]})})})})}class _e extends V.Component{constructor(e){super(e),this.updateHighlight=()=>{var e;if(!this.props.narration||!this.props.audio)return;const t=Math.floor(1e3*(this.props.audio.currentTime||0));0===t?(this.block=null,this.word=null,xe(this.props.narration.options.root)):((!this.block||t<this.block.time||t>=this.block.endtime)&&(this.block=this.props.narration.blockForTimestamp(t),this.word=null),(!this.word||t<this.word.time||t>=this.word.endtime)&&(this.word=(null==(e=this.block)?void 0:e.wordForTimestamp(t))||null,xe(this.props.narration.options.root),this.word&&function(e){const t=new TextEncoder,o=new TextDecoder;for(let s=e.runs.length-1;s>=0;s--){const i=e.runs[s];i.parent.normalize();let r=0,n=0,l="";for(const e of a(i.parent,{type:Node.TEXT_NODE})){const s=t.encode(e.nodeValue);if(n=r+s.length,i.rel>=r&&i.endrel<=n){i.rel>r&&(l=o.decode(s.slice(0,i.rel-r)),i.parent.insertBefore(u("#text",l),e)),l=o.decode(s.slice(i.rel-r,i.endrel-r)),i.parent.insertBefore(u("span",{class:fe},l),e),i.endrel<n?(l=o.decode(s.slice(i.endrel-r,n)),e.nodeValue=l):e.nodeValue="";break}r=n}}}(this.word)))},this.block=null,this.word=null,this.timer=new f({onTimer:this.updateHighlight,delay:50,repeating:!0})}render(){return null}componentDidUpdate(){!this.timer.running&&this.props.playing?this.timer.start():this.timer.running&&!this.props.playing&&this.timer.cancel(),this.timer.running||this.updateHighlight()}componentWillUnmount(){var e;this.timer.cancel(),xe(null==(e=this.props.narration)?void 0:e.options.root)}}function je({ctxapp:e,player:t,audio:o,controls:s,...a}){const i=O();return L.jsx(B,{ref:s.boundRefs.playBtn,variant:"link",disabled:0===s.props.duration,className:"audio-play-control",onClick:e=>{t.togglePlaying()},title:i.formatMessage({id:"Uh5L4WQrALv6",defaultMessage:[{type:0,value:"Play/pause narration audio"}]}),children:L.jsx(g,{icon:t.playing?"faPause":"faPlay",weight:"solid"})})}function ke({ctxapp:e,player:t,audio:o,controls:s,...a}){const i=O(),r=V.useMemo((()=>x({onKeyDown_ArrowLeft:e=>{e.defaultPrevented||(e.preventDefault(),t.setTime("down"))},onKeyDown_ArrowRight:e=>{e.defaultPrevented||(e.preventDefault(),t.setTime("up"))},onKeyDown_Enter:e=>{e.defaultPrevented||(e.preventDefault(),t.togglePlaying())},"onKeyDown_ ":e=>{e.defaultPrevented||(e.preventDefault(),t.togglePlaying())}})),[]);return L.jsx("input",{ref:s.boundRefs.timeSlider,className:"audio-slider-control",title:i.formatMessage({id:"RYCP3lphxydi",defaultMessage:[{type:0,value:"Adjust audio position"}]}),type:"range",value:t.time,min:0,max:t.duration,disabled:0===t.duration,onChange:e=>{t.setTime(e.target.value)},onKeyDown:r})}const Me="vapp-narrate-controls",Se=100,Pe=10,De=100,Ae=[{value:50,label:"0.5",text:"0.5"},{value:75,label:"•",text:"0.75"},{value:100,label:"1.0",text:"1.0"},{value:125,label:"•",text:"1.25"},{value:150,label:"1.5",text:"1.5"},{value:175,label:"•",text:"1.75"},{value:200,label:"2.0",text:"2.0"}];function Re(e){for(let t=0;t<Ae.length;t++)if(e<=Ae[t].value)return t;return Ae.length-1}function Ce(e){let t=e/Se;const o=Math.floor(t/60);return t=Math.floor(t)-60*o,`${o}:`+`0${t}`.slice(-2)}function Ve({ctxapp:e,player:t,audio:o,controls:s,...a}){const i=O(),r=w(),n=b(),l=t.rateIndex,u=V.useMemo((()=>x({onKeyDown_ArrowDown:e=>{e.defaultPrevented||(e.preventDefault(),t.setRate("down"))},onKeyDown_ArrowUp:e=>{e.defaultPrevented||(e.preventDefault(),t.setRate("up"))},onKeyDown_Enter:e=>{e.defaultPrevented||(e.preventDefault(),s.rateBtn.focus())},onKeyDown_Escape:e=>{e.defaultPrevented||(e.preventDefault(),s.rateBtn.focus())}})),[]);return L.jsxs(L.Fragment,{children:[L.jsx(B,{ref:s.boundRefs.rateBtn,variant:"link",className:"audio-rate-control audio-rate-area flex-minimal",title:i.formatMessage({id:"vwGlrYboPYu1",defaultMessage:[{type:0,value:"Adjust audio rate"}]}),onClick:n.toggle,onFocus:e=>{n.value||setTimeout((()=>{n.toggle(!0)}),100)},onBlur:e=>{n.value&&setTimeout((()=>{T(r.docRoot.activeElement,"audio-rate-area")||n.toggle(!1)}),100)},onKeyDown:u,children:Ae[l].text}),L.jsx(E,{show:n.value,setShow:n.toggle,noAutoHide:!0,groupKey:"narrate-controls-popup",target:s.rateBtn,placement:"top",strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,16]}}],children:e=>{const o=t.rate;return L.jsx("div",{className:"audio-rate-container audio-rate-area",onBlur:e=>{setTimeout((()=>{T(r.docRoot.activeElement,"audio-rate-area")||n.toggle(!1)}),100)},children:L.jsx(z,{vertical:!0,children:Ae.map((e=>L.jsx(B,{variant:"link",active:e.value===o,onClick:o=>{t.setRate(e.value)},onKeyDown:u,children:e.label},e.text)))})})}})]})}function Le({ctxapp:e,player:t,audio:o,controls:s,...a}){return L.jsxs("div",{className:"audio-time-control",children:[L.jsx("span",{"aria-label":"Audio Position",role:"timer",children:Ce(t.time||0)}),L.jsx("span",{className:"time-slash",children:" / "}),L.jsx("span",{"aria-label":"Audio Duration",children:Ce(t.duration||0)})]})}function Oe({ctxapp:e,player:t,audio:o,controls:s,...a}){const i=O(),r=w(),n=b(),l=V.useMemo((()=>x({onKeyDown_ArrowUp:e=>{e.defaultPrevented||(e.preventDefault(),t.setVolume("up"))},onKeyDown_ArrowDown:e=>{e.defaultPrevented||(e.preventDefault(),t.setVolume("down"))},onKeyDown_Enter:e=>{e.defaultPrevented||(e.preventDefault(),s.volumeBtn.focus())},onKeyDown_Escape:e=>{e.defaultPrevented||(e.preventDefault(),s.volumeBtn.focus())}})),[]),u=t.volume,p=t.muted;return L.jsxs(L.Fragment,{children:[L.jsx(B,{ref:s.boundRefs.volumeBtn,variant:"link",className:"audio-volume-control audio-volume-area flex-minimal",title:i.formatMessage({id:"nEmyypBigwoj",defaultMessage:[{type:0,value:"Narration audio volume"}]}),onClick:e=>{n.value&&t.toggleMuted()},onFocus:e=>{n.value||setTimeout((()=>{n.toggle(!0)}),100)},onBlur:e=>{n.value&&setTimeout((()=>{T(r.docRoot.activeElement,"audio-volume-area")||n.toggle(!1)}),100)},onKeyDown:l,children:L.jsx(g,{icon:p?"faVolumeMute":u>7?"faVolumeUp":u>3?"faVolume":u>0?"faVolumeDown":"faVolumeOff",weight:"solid"})}),L.jsx(E,{show:n.value,setShow:n.toggle,groupKey:"narrate-controls-popup",noAutoHide:!0,target:s.volumeBtn,placement:"top",strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,14]}}],children:e=>{const o=t.volume,s=t.muted;return L.jsx("div",{className:"audio-volume-container audio-volume-area",children:L.jsx("input",{className:"flex-maximal",type:"range",orient:"vertical",value:s?0:o,min:0,max:Pe,onChange:e=>{t.setVolume(e.target.value)},onBlur:e=>{setTimeout((()=>{T(r.docRoot.activeElement,"audio-volume-area")||n.toggle(!1)}),100)},onKeyDown:l})})}})]})}class Ie extends V.Component{constructor(){super(...arguments),this.playBtn=N(this,"playBtn"),this.volumeBtn=N(this,"volumeBtn"),this.rateBtn=N(this,"rateBtn"),this.timeSlider=N(this,"timeSlider"),this.timer=new f({onTimer:this.props.player.refresh,delay:250,repeating:!0})}componentDidMount(){this.timer.start(),this.props.ctxapp._setPlayerReady(!0),this.props.player.refresh(),ve.dispatch(this.props.webcomp),setTimeout((()=>{var e;null==(e=this.playBtn)||e.focus()}),100)}componentDidUpdate(){!this.timer.running&&this.props.player.playing?this.timer.start():this.timer.running&&!this.props.player.playing&&this.timer.cancel()}componentWillUnmount(){this.props.audio.pause(),this.timer.cancel(),this.props.ctxapp._setPlayerReady(!1)}render(){return L.jsxs("div",{className:"audio-controls","data-playing":this.props.player.playing?"1":"0",children:[L.jsx("div",{className:"audio-controls-item flex-minimal",children:L.jsx(je,{ctxapp:this.props.ctxapp,player:this.props.player,audio:this.props.audio,controls:this})}),L.jsx("div",{className:"audio-controls-item flex-minimal ps-1",children:L.jsx(Le,{ctxapp:this.props.ctxapp,player:this.props.player,audio:this.props.audio,controls:this})}),L.jsx("div",{className:"audio-controls-item flex-maximal ps-1",children:L.jsx(ke,{ctxapp:this.props.ctxapp,player:this.props.player,audio:this.props.audio,controls:this})}),L.jsx("div",{className:"audio-controls-item flex-minimal ps-1",children:L.jsx(Oe,{ctxapp:this.props.ctxapp,player:this.props.player,audio:this.props.audio,controls:this})}),L.jsx("div",{className:"audio-controls-item flex-minimal ps-1",children:L.jsx(Ve,{ctxapp:this.props.ctxapp,player:this.props.player,audio:this.props.audio,controls:this})})]})}}const Be=e("player");class ze extends V.Component{constructor(){super(...arguments),this.audio=N(this,"audio"),this.controls=N(this,"controls"),this.state={counter:0},this.refresh=()=>new Promise((e=>{this.setState({counter:i()},e)})),this.togglePlaying=(e=void 0)=>{(e=void 0===e?!this.playing:e)?this.audio.play():this.audio.pause(),this.refresh()},this.setTime=e=>{"up"===e?e=this.time+500:"down"===e&&(e=this.time-500),e=Math.min(this.duration,Math.max(0,e||0)),this.audio.currentTime=e/Se,this.refresh()},this.toggleMuted=(e=void 0)=>{e=void 0===e?!this.audio.muted:e,this.audio.muted=e,this.saveSettings(),this.refresh()},this.setVolume=e=>{"up"===e?e=this.audio.volume*Pe+1:"down"===e&&(e=this.audio.volume*Pe-1),e=Math.min(Pe,Math.max(0,e||0)),this.audio.volume=_(e/Pe,1),this.audio.muted=!1,this.saveSettings(),this.refresh()},this.setRate=e=>{let t;t="up"===e?this.rateIndex+1:"down"===e?this.rateIndex-1:Re(e),t=Math.min(Ae.length-1,Math.max(0,t)),this.audio.playbackRate=Ae[t].value/De,this.saveSettings(),this.refresh()},this.restoreSettings=()=>{let e={};try{e=JSON.parse(localStorage.getItem(Me))||e}catch(t){Be.info("unable to parse player settings: {}",t.toString())()}this.toggleMuted(e.muted||!1),this.setVolume(e.hasOwnProperty("volume")?e.volume:Pe),this.setRate(e.hasOwnProperty("rate")?e.rate:De)},this.saveSettings=()=>{try{localStorage.setItem(Me,JSON.stringify({muted:this.muted,volume:this.volume,rate:this.rate}))}catch(e){Be.info("unable to save player settings: {}",e.toString())()}}}componentDidMount(){this.restoreSettings(),this.props.ctxapp.resetNarration(),this.props.ctxapp.initNarration(),ue.dispatch(this.props.webcomp)}componentWillUnmount(){this.saveSettings(),this.props.ctxapp.resetNarration(),de.dispatch(this.props.webcomp)}render(){var e;return L.jsxs("div",{className:"audio-player",role:"dialog","aria-modal":"false","aria-label":"Narration Audio Player",children:[this.props.ctxapp.error?L.jsxs("div",{className:"flex-maximal ps-1",children:["Error: ",j(this.props.ctxapp.error)]}):this.props.ctxapp.narration&&this.audio&&this.duration?L.jsx(Ie,{ref:this.boundRefs.controls,ctxapp:this.props.ctxapp,webcomp:this.props.webcomp,audio:this.audio,player:this}):L.jsx("div",{className:"flex-maximal ps-1",children:L.jsx(K,{className:"audio-loading-progress flex-maximal",animated:!0,now:100})}),L.jsx("div",{className:"flex-minimal ps-0p5",children:L.jsx(B,{variant:"link",className:"audio-player-close p-0p5","aria-label":"Close narrate tool",onClick:e=>{this.props.ctxapp.togglePlayer(!1)},children:L.jsx(g,{icon:"faTimes",className:"fs-1"})})}),L.jsx(_e,{narration:this.props.ctxapp.narration,audio:this.audio,playing:!(!this.audio||this.audio.paused)}),L.jsx("audio",{ref:this.boundRefs.audio,onPlay:this.refresh,onPause:this.refresh,onEnded:this.refresh,onVolumeChange:this.refresh,onRateChange:this.refresh,onDurationChange:this.refresh,children:(null==(e=this.props.ctxapp.narration)?void 0:e.id)&&L.jsx("source",{src:`${t.VOSHI_NARRATION_URL}/${this.props.ctxapp.narration.id}.${this.props.ctxapp.narration.options.lang_code}.${this.props.ctxapp.narration.options.voice_id}.mp3`,type:"audio/mpeg"})})]})}get playing(){var e;return!(null==(e=this.audio)?void 0:e.paused)}get time(){var e;return((null==(e=this.audio)?void 0:e.currentTime)||0)*Se}get duration(){var e;return((null==(e=this.audio)?void 0:e.duration)||0)*Se}get volume(){var e;return((null==(e=this.audio)?void 0:e.volume)||0)*Pe}get muted(){var e;return null==(e=this.audio)?void 0:e.muted}get rate(){var e;return((null==(e=this.audio)?void 0:e.playbackRate)||0)*De}get rateIndex(){var e;return Re(((null==(e=this.audio)?void 0:e.playbackRate)||0)*De)}}function Ke(e){const t=w(),o=$();return L.jsxs(L.Fragment,{children:[o.switchVisible&&L.jsx(Ne,{ctxapp:o,webcomp:t}),o.playerVisible&&L.jsx(ze,{ctxapp:o,webcomp:t})]})}const Ue={en:{FnfezUqXGjMI:[{type:0,value:"across the "},{type:1,value:"subs"},{type:0,value:" most recent "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:"."}],Vn6sjvEwHkZK:[{type:1,value:"count"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"record"}]},other:{value:[{type:0,value:"records"}]}},pluralType:"cardinal",type:6,value:"count"},{type:0,value:"."}],Vrh8f2BVOLwy:[{type:0,value:"Search"}],"admin.pages.search.form.placeholder":[{type:0,value:"Search"}],c_3Gzhj7KLHI:[{type:1,value:"subs"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:" allowed."}],"epoch.duration.days":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"day"}]},other:{value:[{type:0,value:"days"}]},two:{value:[{type:0,value:"days"}]},zero:{value:[{type:0,value:"days"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.hours":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"hour"}]},other:{value:[{type:0,value:"hours"}]},two:{value:[{type:0,value:"hours"}]},zero:{value:[{type:0,value:"hours"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.millis":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"millisecond"}]},other:{value:[{type:0,value:"milliseconds"}]},two:{value:[{type:0,value:"milliseconds"}]},zero:{value:[{type:0,value:"milliseconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.minutes":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"minute"}]},other:{value:[{type:0,value:"minutes"}]},two:{value:[{type:0,value:"minutes"}]},zero:{value:[{type:0,value:"minutes"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.seconds":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"second"}]},other:{value:[{type:0,value:"seconds"}]},two:{value:[{type:0,value:"seconds"}]},zero:{value:[{type:0,value:"seconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.weeks":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"week"}]},other:{value:[{type:0,value:"weeks"}]},two:{value:[{type:0,value:"weeks"}]},zero:{value:[{type:0,value:"weeks"}]}},pluralType:"cardinal",type:6,value:"num"}],fkUMsTGn8rzM:[{type:0,value:"asdfasdf"}],"reader.pages.index.noauth":[{type:0,value:"Not authenticated: please launch from your LMS."}]},es:{FnfezUqXGjMI:[{type:0,value:"across the "},{type:1,value:"subs"},{type:0,value:" most recent "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:"."}],Vn6sjvEwHkZK:[{type:1,value:"count"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"record"}]},other:{value:[{type:0,value:"records"}]}},pluralType:"cardinal",type:6,value:"count"},{type:0,value:"."}],Vrh8f2BVOLwy:[{type:0,value:"Search"}],"admin.pages.search.form.placeholder":[{type:0,value:"Search"}],c_3Gzhj7KLHI:[{type:1,value:"subs"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:" allowed."}],"epoch.duration.days":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"day"}]},other:{value:[{type:0,value:"days"}]},two:{value:[{type:0,value:"days"}]},zero:{value:[{type:0,value:"days"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.hours":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"hour"}]},other:{value:[{type:0,value:"hours"}]},two:{value:[{type:0,value:"hours"}]},zero:{value:[{type:0,value:"hours"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.millis":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"millisecond"}]},other:{value:[{type:0,value:"milliseconds"}]},two:{value:[{type:0,value:"milliseconds"}]},zero:{value:[{type:0,value:"milliseconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.minutes":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"minute"}]},other:{value:[{type:0,value:"minutes"}]},two:{value:[{type:0,value:"minutes"}]},zero:{value:[{type:0,value:"minutes"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.seconds":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"second"}]},other:{value:[{type:0,value:"seconds"}]},two:{value:[{type:0,value:"seconds"}]},zero:{value:[{type:0,value:"seconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.weeks":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"week"}]},other:{value:[{type:0,value:"weeks"}]},two:{value:[{type:0,value:"weeks"}]},zero:{value:[{type:0,value:"weeks"}]}},pluralType:"cardinal",type:6,value:"num"}],fkUMsTGn8rzM:[{type:0,value:"Not authenticated: please launch from your LMS."}],"reader.pages.index.noauth":[{type:0,value:"Not authenticated: please launch from your LMS."}]}};R.setOptions({strict:!1});const $e=e("app"),He=class extends k{constructor(){super(...arguments),this.provider=null,this._setAppProvider=e=>{this.provider=e}}connectedCallback(){if(super.connectedCallback(),!document.getElementById(`#${ye}`)){const e=document.createElement("div");e.innerHTML=ge.trim(),document.head.appendChild(e.firstChild)}this.isStandalone&&window.setTimeout(Fe,500)}};async function Fe(){try{const e=await c({url:`${t.VOSHI_STATIC_URL}/narrate/lily.html`}).promise,o=(new DOMParser).parseFromString(e.body,"text/html");for(const t of a(o.body))document.body.appendChild(t);const s=document.querySelector("vapp-narrate");s.setAttribute("lang_code","en-US"),s.setAttribute("voice_id","Ruth"),document.querySelector("vapp-narrate").addEventListener("vapp-ready",(e=>{e.isReady&&e.webcomp.provider.togglePlayer(!0)}))}catch(e){$e.error("unable to inject testing content: {}",e)()}}He.ELEMENT_NAME="NarrateElement",He.ELEMENT_TAG=`vapp-${t.VOSHI_APP}`,He.CONFIG={...k.CONFIG,root:void 0,selectors:void 0,ignores:void 0,voice_id:void 0,lang_code:void 0,"meta-title":void 0,"meta-compilation":void 0,"meta-publisher":void 0,"meta-source":void 0},He.ATTRIBUTES={...k.ATTRIBUTES,noswitch:void 0,show:void 0},He.REACT_COMPONENT=function({webcomp:e,...t}){return L.jsx(M,{messages:Ue,children:L.jsx(S,{initializing:L.jsx(P,{className:"my-4"}),children:()=>L.jsx(D,{children:L.jsx(Ee,{ref:e._setAppProvider,webcomp:e,children:L.jsx(Ke,{})})})})})},function(s){const a=e("voshi");try{if(!t.VOSHI_APP)throw new Error("environment is missing VOSHI_APP");if(!t.VOSHI_STAGE)throw new Error("environment is missing VOSHI_STAGE");if(!t.VOSHI_BUILD)throw new Error("environment is missing VOSHI_BUILD");if(!t.VOSHI_PLATFORM)throw new Error("environment is missing VOSHI_PLATFORM");a.force("welcome to {}",t.appsig)(),t.appsig!==o.appsig&&a.force("built as {}",o.appsig)(),customElements.get(s.ELEMENT_TAG)?a.info(`custom element already defined for <${s.ELEMENT_TAG}>`)():(a.info(`defining custom element ${s.ELEMENT_NAME} for <${s.ELEMENT_TAG}>`)(),customElements.define(s.ELEMENT_TAG,s))}catch(i){a.error("Error loading app",i)()}}(He);
