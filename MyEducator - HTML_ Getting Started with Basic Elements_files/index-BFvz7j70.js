import{g as e,e as a,a as s,c as t,b as n,n as i,u as l,I as r,i as o,B as c,L as u,A as d,d as h,M as p}from"./app-lib-BxlMCJu6.js";import{f as m}from"./vendor-base-eX2cs-oa.js";import{R as v,a0 as y,j as f,r as x,a1 as g,a2 as j,a3 as b,a4 as N}from"./vendor-other-C1YCSuhK.js";import"./vendor-xml-0NFUgpxB.js";import"./vendor-intl-DnSgMlr2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?a.credentials="include":"anonymous"===e.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const w=v.createContext({});function A(){return v.useContext(w).instance}w.displayName="DashboardContext",t(w,"_dashboard_context_wrapper",(e=>{e.ctxChat=e._dashboard_context_wrapper.instance}));const E=e("ai-dashboard"),S=y(class extends v.PureComponent{constructor(){super(...arguments),this.coursenum=this.props.coursenum,this.state={renderCounter:-1,files:[],processing:!1,customInstructions:"",loadingInstructions:!1,savingInstructions:!1,instructionsError:null,features:{},isAIEnabled:!1},this.fetchInstructions=async()=>{this.setState({loadingInstructions:!0,instructionsError:null});try{const e=n("aichat","v1"),a=await e.get({path:`context_manager/${this.coursenum}/instructions`}),s=await a.data;this.setState({customInstructions:s.instructions,loadingInstructions:!1})}catch(e){this.setState({instructionsError:e.message,loadingInstructions:!1})}},this.saveInstructions=async e=>{this.setState({savingInstructions:!0,instructionsError:null});try{const a=n("aichat","v1");await a.post({path:`context_manager/${this.coursenum}/instructions`,data:{instructions:e}}),this.setState({customInstructions:e,savingInstructions:!1})}catch(a){this.setState({instructionsError:a.message,savingInstructions:!1})}},this.fetchFiles=async()=>{try{const e=n("aichat","v1"),a=await e.get({path:`context_manager/${this.coursenum}`}),s=await a.data;this.setState({files:s}),this.setState({renderCounter:i()})}catch(e){E.error("Error fetching files:",e)()}},this.uploadFile=async(e,a,s)=>{const t=n("aichat","v1"),l=await t.post({path:`context_manager/${this.coursenum}/get_presigned_url`,data:{file_extension:e.name.split(".").pop(),upload_file_category:a,chapter_section:s}}),r=await l.data,o=r.url,c=r.file_key,u={"Content-Type":r.content_type,"x-amz-meta-coursenum":this.coursenum,"x-amz-meta-chapter_section":s,"x-amz-meta-upload_file_category":a};await fetch(o,{method:"PUT",body:e,headers:u}),this.setState({renderCounter:i()}),this.processFile(c)},this.processFile=async e=>{const a=n("aichat","v1"),s=await a.post({path:`context_manager/${this.coursenum}/process_file/`,data:{document_id:e}});if(!s.ok)throw new Error(`Error processing file: ${s.statusText}`);this.setState({renderCounter:i()})},this.deleteFile=async e=>{try{const a=n("aichat","v1");await a.post({path:`context_manager/${this.coursenum}/delete`,data:{id:e.id,type:e.type}}),this.setState((a=>({files:a.files.filter((a=>a.id!==e.id))})))}catch(a){E.error("Error deleting file:",a)()}},this.saveQA=async e=>{try{const a=n("aichat","v1");await a.post({path:`context_manager/${this.coursenum}/qa`,data:{question:e.question,answer:e.answer}})}catch(a){E.error("Error saving QA:",a)()}},this.fetchQAs=async()=>{try{const e=n("aichat","v1"),a=await e.get({path:`context_manager/${this.coursenum}/qa`});return await a.data}catch(e){return E.error("Error fetching Q&As:",e)(),[]}},this.deleteQA=async e=>{try{const a=n("aichat","v1");await a.post({path:`context_manager/${this.coursenum}/qa/${e.id}`})}catch(a){E.error("Error deleting QA:",a)()}},this.fetchFeatures=async()=>{try{const e=n("aichat","v1"),a=await e.get({path:`context_manager/${this.coursenum}/features`});return await a.data}catch(e){throw E.error("Error fetching features:",e)(),e}},this.fetchAndSetFeatures=async()=>{var e;try{const a=await this.fetchFeatures();this.setState({features:a,isAIEnabled:(null==(e=null==a?void 0:a.AI)?void 0:e.enabled)??!0})}catch(a){E.error("Error setting features:",a)()}},this.updateFeature=async(e,a)=>{try{const s=n("aichat","v1");await s.post({path:`context_manager/${this.coursenum}/features`,data:{feature:e,enabled:a}}),"AI"===e&&this.setState({isAIEnabled:a}),this.setState((s=>({features:{...s.features,[e]:{...s.features[e],enabled:a}}})))}catch(s){throw E.error("Error updating feature:",s)(),s}},this.fetchAnalyticsData=async()=>{try{const e=n("aichat","v1"),a={coursenum:this.coursenum,queries:["daily_chat","total_users","language_usage","assessment_violations","moderation_violations"]},s=await e.post({path:"analytics/all",data:a}),t=await s.data,i=t.results.athena||t.results.firebolt;if(!i)throw new Error("No analytics data available from Athena or Firebolt.");const l=parseInt(i.total_users??0,10),r=parseInt(i.assessment_violations??0,10),o=parseInt(i.moderation_violations??0,10),c=Array.isArray(i.daily_chat)?i.daily_chat.map((e=>({date:e.date,chatCount:e.chat_count}))):[],u=Array.isArray(i.language_usage)?i.language_usage.reduce(((e,a)=>e+parseInt(a.count,10)),0):0;return{dailyUsage:c,totalActiveUsers:l,topLanguages:Array.isArray(i.language_usage)?i.language_usage.map((e=>({language:e.language,percentage:u>0?(parseInt(e.count,10)/u*100).toFixed(2):"0.00"}))):[],assessmentViolations:r,moderationViolations:o}}catch(e){return E.error("Error fetching analytics data:",e)(),{dailyUsage:[],totalActiveUsers:0,topLanguages:[],assessmentViolations:0,moderationViolations:0}}}}componentDidMount(){this.fetchInstructions(),this.fetchFiles(),this.fetchQAs(),this.fetchAndSetFeatures(),this.setState({renderCounter:i()})}render(){return f.jsx(w.Provider,{value:{instance:this},children:this.props.children})}}),I={en:{FnfezUqXGjMI:[{type:0,value:"across the "},{type:1,value:"subs"},{type:0,value:" most recent "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:"."}],Vn6sjvEwHkZK:[{type:1,value:"count"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"record"}]},other:{value:[{type:0,value:"records"}]}},pluralType:"cardinal",type:6,value:"count"},{type:0,value:"."}],Vrh8f2BVOLwy:[{type:0,value:"Search"}],"admin.pages.search.form.placeholder":[{type:0,value:"Search"}],c_3Gzhj7KLHI:[{type:1,value:"subs"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:" allowed."}],"epoch.duration.days":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"day"}]},other:{value:[{type:0,value:"days"}]},two:{value:[{type:0,value:"days"}]},zero:{value:[{type:0,value:"days"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.hours":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"hour"}]},other:{value:[{type:0,value:"hours"}]},two:{value:[{type:0,value:"hours"}]},zero:{value:[{type:0,value:"hours"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.millis":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"millisecond"}]},other:{value:[{type:0,value:"milliseconds"}]},two:{value:[{type:0,value:"milliseconds"}]},zero:{value:[{type:0,value:"milliseconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.minutes":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"minute"}]},other:{value:[{type:0,value:"minutes"}]},two:{value:[{type:0,value:"minutes"}]},zero:{value:[{type:0,value:"minutes"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.seconds":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"second"}]},other:{value:[{type:0,value:"seconds"}]},two:{value:[{type:0,value:"seconds"}]},zero:{value:[{type:0,value:"seconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.weeks":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"week"}]},other:{value:[{type:0,value:"weeks"}]},two:{value:[{type:0,value:"weeks"}]},zero:{value:[{type:0,value:"weeks"}]}},pluralType:"cardinal",type:6,value:"num"}],fkUMsTGn8rzM:[{type:0,value:"asdfasdf"}],"reader.pages.index.noauth":[{type:0,value:"Not authenticated: please launch from your LMS."}]},es:{FnfezUqXGjMI:[{type:0,value:"across the "},{type:1,value:"subs"},{type:0,value:" most recent "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:"."}],Vn6sjvEwHkZK:[{type:1,value:"count"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"record"}]},other:{value:[{type:0,value:"records"}]}},pluralType:"cardinal",type:6,value:"count"},{type:0,value:"."}],Vrh8f2BVOLwy:[{type:0,value:"Search"}],"admin.pages.search.form.placeholder":[{type:0,value:"Search"}],c_3Gzhj7KLHI:[{type:1,value:"subs"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:" allowed."}],"epoch.duration.days":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"day"}]},other:{value:[{type:0,value:"days"}]},two:{value:[{type:0,value:"days"}]},zero:{value:[{type:0,value:"days"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.hours":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"hour"}]},other:{value:[{type:0,value:"hours"}]},two:{value:[{type:0,value:"hours"}]},zero:{value:[{type:0,value:"hours"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.millis":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"millisecond"}]},other:{value:[{type:0,value:"milliseconds"}]},two:{value:[{type:0,value:"milliseconds"}]},zero:{value:[{type:0,value:"milliseconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.minutes":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"minute"}]},other:{value:[{type:0,value:"minutes"}]},two:{value:[{type:0,value:"minutes"}]},zero:{value:[{type:0,value:"minutes"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.seconds":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"second"}]},other:{value:[{type:0,value:"seconds"}]},two:{value:[{type:0,value:"seconds"}]},zero:{value:[{type:0,value:"seconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.weeks":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"week"}]},other:{value:[{type:0,value:"weeks"}]},two:{value:[{type:0,value:"weeks"}]},zero:{value:[{type:0,value:"weeks"}]}},pluralType:"cardinal",type:6,value:"num"}],fkUMsTGn8rzM:[{type:0,value:"Not authenticated: please launch from your LMS."}],"reader.pages.index.noauth":[{type:0,value:"Not authenticated: please launch from your LMS."}]}};function T({activePage:e,onPageChange:a}){return f.jsx("nav",{className:"menu",children:f.jsx("ul",{children:[{name:"Usage",id:"usage"},{name:"Feature Controls",id:"feature-controls"},{name:"Custom Instructions",id:"custom-instructions"},{name:"File Management",id:"file-management"},{name:"Q&As",id:"qas"}].map((s=>f.jsx("li",{children:f.jsx("button",{className:"menu-item "+(e===s.id?"selected":""),onClick:()=>a(s.id),children:s.name})},s.name)))})})}const _=()=>{const e=A(),a=l(),[s,t]=x.useState(!0);x.useEffect((()=>{(async()=>{t(!0);try{await e.fetchAndSetFeatures()}catch(s){a.addToast("Failed to load feature settings.",{fontSize:"16px"})}finally{t(!1)}})()}),[e,a]);const n=({featureKey:s,featureData:t})=>"AI"===s?null:f.jsxs("div",{className:"feature-item "+(e.state.isAIEnabled?"":"disabled"),children:[f.jsxs("div",{className:"feature-content",children:[f.jsx("h3",{children:t.title}),f.jsx("p",{children:t.description})]}),f.jsxs("button",{className:"toggle-button "+(t.enabled?"active":""),onClick:()=>(async s=>{try{await e.updateFeature(s,!e.state.features[s].enabled),a.addToast("Feature updated successfully!",{fontSize:"16px"})}catch(t){a.errorToast(t,{fontSize:"16px"})}})(s),disabled:!e.state.isAIEnabled,children:[f.jsx("div",{className:"toggle-slider",children:f.jsx("div",{className:"toggle-circle"})}),f.jsx("span",{className:"toggle-text",children:t.enabled?"Enabled":"Disabled"})]})]});return f.jsxs("div",{className:"feature-controls-container",children:[f.jsx("h1",{children:"Feature Controls"}),f.jsx("p",{className:"subheader",children:"Control the AI features available in your course."}),s?f.jsx("div",{className:"loading",children:"Loading feature settings..."}):f.jsx("div",{className:"features-list",children:Object.entries(e.state.features).map((([e,a])=>f.jsx(n,{featureKey:e,featureData:a},e)))})]})},C=()=>{const e=A(),a=l(),[s,t]=x.useState(""),[n,i]=x.useState(!0),[o,c]=x.useState(!1),[u,d]=x.useState(!1);x.useEffect((()=>{(async()=>{i(!0);try{await e.fetchInstructions(),t(e.state.customInstructions)}catch(s){a.errorToast(s,{fontSize:"16px"})}finally{i(!1)}})()}),[e,a]);return f.jsxs("div",{className:"custom-instructions-container "+(e.state.isAIEnabled?"":"disabled"),children:[f.jsx("h1",{children:"Custom Instructions"}),f.jsxs("h2",{className:"subheader-instructions",children:["Instructions entered here will be used to guide the AI in generating responses. Instructions can degrade performance if they are not clear and concise. "," ",f.jsx("button",{onClick:()=>d(!0),className:"examples-button","aria-label":"View examples of custom instructions",disabled:!e.state.isAIEnabled,children:"See examples of custom instructions here"}),"."]}),n?f.jsx("div",{className:"loading",children:"Loading instructions..."}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"instructions-textarea-container "+(e.state.isAIEnabled?"":"disabled"),children:f.jsx("textarea",{className:"instructions-textarea",value:s,onChange:e=>{t(e.target.value)},placeholder:"Enter custom instructions...",disabled:!e.state.isAIEnabled})}),f.jsx("div",{className:"save-button-container "+(e.state.isAIEnabled?"":"disabled"),children:f.jsxs("button",{className:"save-button",onClick:async()=>{c(!0);try{await e.saveInstructions(s),a.addToast("Instructions saved successfully!",{fontSize:"16px"})}catch(t){a.errorToast(t,{fontSize:"16px"})}finally{c(!1)}},disabled:o||!e.state.isAIEnabled,children:[f.jsx(r,{icon:"faSave"})," ",o?"Saving...":"Save"]})})]}),u&&f.jsx("div",{className:"modal-overlay",role:"dialog","aria-modal":"true",children:f.jsxs("div",{className:"custom-modal-instructions",children:[f.jsx("h2",{className:"modal-title",children:"Custom Instructions Examples"}),f.jsx("ul",{className:"examples-list",children:[{title:"Provide Detailed Explanations",instructions:"For each query, provide a detailed and comprehensive explanation to help students understand the topic thoroughly."},{title:"Use Simple Language",instructions:"Respond using clear and simple language to ensure all students can easily understand the material."},{title:"Incorporate Examples",instructions:"Include relevant examples in each response to illustrate and clarify key concepts for better understanding."}].map(((a,n)=>f.jsxs("li",{className:"example-item",children:[f.jsx("h3",{children:a.title}),f.jsx("p",{children:a.instructions}),f.jsx("button",{onClick:()=>{t(s?s+"\n"+a.instructions:a.instructions),d(!1)},className:"insert-button","aria-label":`Insert ${a.title} instructions`,disabled:!e.state.isAIEnabled,children:f.jsx(r,{className:"insert-icon",icon:"faPlus"})})]},n)))}),f.jsx("button",{onClick:()=>d(!1),className:"close-modal-button","aria-label":"Close examples modal",children:f.jsx(r,{icon:"faTimes"})})]})})]})},k={textbook:"MyEducator Textbook",glossary:"Glossary Terms",assessment:"Assessment Questions",qa:"Questions and Answers",video:"Textbook Video Transcripts",image:"Textbook Image Descriptions"},F=["textbook","glossary","assessment","qa","video","image"],z=["textbook","assessment","video","image","glossary","materials","syllabus","assignments","exams","other"],L=()=>{const e=A(),a=l(),[s,t]=x.useState(!1),[n,i]=x.useState(null),[o,c]=x.useState(!1),[u,d]=x.useState(null),[h,p]=x.useState("materials"),[m,v]=x.useState(!1),[y,g]=x.useState(!1);x.useEffect((()=>{(async()=>{v(!0);try{await e.fetchFiles()}catch(s){a.errorToast(s,{fontSize:"16px"})}finally{v(!1)}})()}),[e,a]);const j=e=>/(\.pdf|\.txt|\.docx)$/i.test(e.name);return f.jsxs("div",{className:"file-management-container "+(e.state.isAIEnabled?"":"disabled"),children:[f.jsx("h1",{children:"File Management"}),f.jsx("p",{className:"subheader",children:"Add files on which the various MyEducator tools can be trained to provide custom material to the students."}),f.jsxs("div",{className:"button-row",children:[f.jsxs("button",{className:"add-file-button",onClick:()=>{c(!0)},disabled:!e.state.isAIEnabled,children:[f.jsx(r,{icon:"faPlus",className:"add-icon",solid:!0}),f.jsx("span",{children:"Add File"})]}),f.jsxs("button",{className:"refresh-button",onClick:async()=>{v(!0);try{await e.fetchFiles(),a.addToast("File list refreshed",{fontSize:"16px"})}catch(s){a.errorToast(s,{fontSize:"16px"})}finally{v(!1)}},"aria-label":"Refresh files",disabled:!e.state.isAIEnabled,children:[f.jsx("span",{className:"refresh-button-label",children:"Refresh List"}),f.jsx(r,{icon:m?"fa-spinner":"fa-sync-alt",className:"refresh-icon "+(m?"spin":""),solid:!0})]})]}),f.jsx("div",{className:"file-list",children:[...e.state.files].sort(((e,a)=>{const s=F.includes(e.type),t=F.includes(a.type);return s&&!t?1:!s&&t?-1:0})).map((a=>{const s=!F.includes(a.type),n="processing"===a.status||a.isProcessing;return f.jsxs("div",{className:`file-item \n                                    ${e.state.isAIEnabled?"":"disabled"} \n                                    ${!n&&s?"has-remove":""} \n                                    ${s?"removable":""}`,children:[f.jsx("div",{className:"file-header",children:f.jsx("span",{className:"file-name",children:a.displayName||(l=a.type,k[l]||l)})}),f.jsxs("div",{className:"file-info",children:[f.jsx("div",{className:"info-row",children:a.progress&&f.jsxs("div",{className:"stats",children:[(()=>{const e=a.progress.total||0,s=a.progress.error||0;return s>10&&(e>0?s/e*100:0)>=10&&s>0?f.jsxs("div",{className:"stat-item",title:F.includes(a.type)?"There was an error getting the bot all its needed context. Please reach out to MyEducator for support.":"There was an error uploading the file. You can try removing and uploading again.",children:[f.jsx(r,{icon:"faExclamationCircle",className:"danger",solid:!0}),"Error"]}):null})(),(a.progress.processing>0||n)&&f.jsxs("div",{className:"stat-item",title:"File is currently being processed. This may take a few minutes.",children:[f.jsx(r,{icon:"faClock",className:"warning",solid:!0}),"Processing"]}),a.progress.completed>0&&!a.progress.processing&&!n&&(()=>{const e=a.progress.total||0,s=a.progress.error||0;return 0===s||s<=10||(e>0?s/e*100:0)<10})()&&f.jsxs("div",{className:"stat-item",title:a.progress.error>0?"Item has loaded successfully with some minor errors. The AI has access to most of the information.":"Item has loaded successfully and the AI has access to the information.",children:[f.jsx(r,{icon:"faCheckCircle",className:"success",solid:!0}),"Completed"]})]})}),f.jsx("div",{className:"info-row",children:f.jsxs("span",{className:"last-updated",children:["Last Updated: ",new Date(a.lastUpdated).toLocaleString()]})}),!n&&s&&f.jsx("div",{className:"info-row",children:f.jsxs("button",{className:"delete-button",onClick:()=>(e=>{i(e),t(!0)})(a),disabled:!e.state.isAIEnabled,children:[f.jsx(r,{icon:"faTrash",className:"delete-icon",solid:!0,"aria-hidden":"true"}),f.jsx("span",{children:"Remove"})]})})]})]},a.id);var l}))}),s&&f.jsx("div",{className:"modal-overlay",children:f.jsxs("div",{className:"delete-modal",children:[f.jsx("h2",{children:"Confirm Delete"}),f.jsx("p",{children:"Are you sure you want to delete this file?"}),f.jsxs("div",{className:"modal-buttons",children:[f.jsx("button",{onClick:async()=>{g(!0);try{await e.deleteFile(n),a.addToast("File deleted successfully",{fontSize:"16px"}),t(!1),i(null)}catch(s){a.errorToast(s,{fontSize:"16px"})}finally{g(!1)}},disabled:!e.state.isAIEnabled||y,children:y?f.jsxs(f.Fragment,{children:[f.jsx(r,{icon:"fa-spinner",className:"spin",solid:!0,"aria-hidden":"true"}),f.jsx("span",{children:"Deleting..."})]}):"Yes, Delete"}),f.jsx("button",{onClick:()=>{t(!1),i(null)},disabled:y,children:"Cancel"})]})]})}),o&&f.jsx("div",{className:"modal-overlay",children:f.jsxs("div",{className:"add-file-modal",children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("h2",{children:"Add New File"}),f.jsx("button",{className:"close-button",onClick:()=>c(!1),children:f.jsx(r,{icon:"faTimes",solid:!0,"aria-hidden":"true"})})]}),f.jsxs("div",{className:"file-upload-area",children:[f.jsx("input",{type:"file",onChange:e=>{const s=e.target.files[0];s&&j(s)?d(s):a.errorToast("Invalid file type. Please select a PDF, TXT, or DOCX file.",{fontSize:"16px"})},accept:".pdf,.txt,.docx",disabled:!e.state.isAIEnabled}),f.jsxs("select",{value:h,onChange:e=>{const a=e.target.value;p(a)},disabled:!e.state.isAIEnabled,children:[f.jsx("option",{value:"materials",children:"Materials"}),f.jsx("option",{value:"syllabus",children:"Syllabus"}),f.jsx("option",{value:"assignments",children:"Assignments"}),f.jsx("option",{value:"exams",children:"Exams"}),f.jsx("option",{value:"other",children:"Other"})]}),f.jsxs("div",{className:"modal-buttons",children:[f.jsx("button",{className:"upload-button",onClick:async()=>{if(!u||!h)return;const s=u.name,t=(a=>{const s=a.substring(0,a.lastIndexOf(".")).toLowerCase();return z.includes(s)?{valid:!1,error:`"${s}" is a reserved keyword and cannot be used as a filename. Please rename your file and try uploading again.`}:e.state.files.find((e=>e.type===s||e.type===h&&e.displayName===a))?{valid:!1,error:"A file with this name already exists. Please rename the file and try uploading again."}:{valid:!0}})(s);if(!t.valid)return void a.errorToast(t.error,{fontSize:"16px"});const n=s.substring(0,s.lastIndexOf("."))||s,i=s.replace(/[^a-z0-9]/gi,"_").toLowerCase(),l=`${Date.now()}-${i}`,r={id:`${e.coursenum}/${l}.pdf_0`,type:h,lastUpdated:(new Date).toISOString(),name:s,displayName:s,status:"processing",isProcessing:!0,progress:{total:1,processing:1,completed:0,error:0}};d(null),p("materials"),c(!1),e.setState((e=>({...e,files:[...e.files,r]})));try{await e.uploadFile(u,h,n),a.addToast("File uploaded successfully, it may take a few minutes to process.",{fontSize:"16px"});let s=0;const t=12,i=async()=>{var n;if(s>=t)return void e.setState((e=>({...e,files:e.files.filter((e=>e.id!==r.id))})));s++,1===s&&await new Promise((e=>setTimeout(e,7e3)));const l=await(async()=>{v(!0);try{const a=await e.fetchFiles();if(!a)return;return e.setState((e=>{const s=e.files.filter((e=>e.isProcessing||"processing"===e.status)),t=new Map;(a.files||[]).forEach((e=>{var a;const s=e.id.split("_")[0];t.has(s)?"processing"!==e.status&&(null==(a=e.progress)?void 0:a.completed)>0&&t.set(s,e):t.set(s,e)}));const n=Array.from(t.values());return s.forEach((e=>{const a=e.id.split("_")[0];n.some((e=>{var s;return e.id.split("_")[0]===a&&"processing"!==e.status&&(null==(s=e.progress)?void 0:s.completed)>0}))||n.push(e)})),{...e,files:n}})),a}catch(s){console.error("Background refresh failed:",s),a.errorToast(s,{fontSize:"16px"})}finally{v(!1)}})(),o=r.id.split("_")[0],c=((null==l?void 0:l.files)||[]).find((e=>e.id.split("_")[0]===o));c&&"processing"!==c.status&&(null==(n=c.progress)?void 0:n.completed)>0||setTimeout(i,5e3)};setTimeout(i,2e3)}catch(o){e.setState((e=>({...e,files:e.files.filter((e=>e.id!==r.id))}))),a.errorToast(o,{fontSize:"16px"})}},disabled:!u||!e.state.isAIEnabled,children:"Upload"}),f.jsx("button",{className:"cancel-button",onClick:()=>c(!1),children:"Cancel"})]})]})]})})]})},P=()=>{const e=A(),a=l(),{isAIEnabled:s}=e.state,[t,n]=x.useState(""),[i,o]=x.useState(""),[c,u]=x.useState([]),[d,h]=x.useState(!0),[p,m]=x.useState(!1),[v,y]=x.useState(!1),[g,j]=x.useState(!1),[b,N]=x.useState(null);x.useEffect((()=>{(async()=>{h(!0);try{const a=await e.fetchQAs();u(a)}catch(s){a.errorToast(s,{fontSize:"16px"})}finally{h(!1)}})()}),[e,a]);return f.jsxs("div",{className:"qa-page-container "+(s?"":"disabled"),children:[f.jsx("h1",{children:"Questions and Answers"}),f.jsx("h2",{className:"subheader",children:"We understand that some of the questions that students will ask require course-specific answers. Add those here for the various AI tools to reference."}),f.jsxs("div",{className:"qa-form",children:[f.jsxs("div",{className:"qa-input",children:[f.jsx("label",{htmlFor:"question",children:"Question:"}),f.jsx("textarea",{id:"question",value:t,onChange:e=>n(e.target.value),placeholder:"Enter your question here...",disabled:!e.state.isAIEnabled})]}),f.jsxs("div",{className:"qa-input",children:[f.jsx("label",{htmlFor:"answer",children:"Answer:"}),f.jsx("textarea",{id:"answer",value:i,onChange:e=>o(e.target.value),placeholder:"Enter your answer here...",disabled:!e.state.isAIEnabled})]}),f.jsxs("div",{className:"qa-buttons",children:[f.jsxs("button",{onClick:async()=>{if(t&&i){m(!0);try{const s={question:t,answer:i};await e.saveQA(s),u([...c,s]),n(""),o(""),a.addToast("Q&A saved successfully!",{fontSize:"16px"})}catch(s){a.errorToast(s,{fontSize:"16px"})}finally{m(!1)}}},disabled:p||!t||!i||!e.state.isAIEnabled,className:"save-button",children:[f.jsx(r,{icon:"faCheck",className:"button-icon"}),p?"Saving...":"Save"]}),f.jsxs("button",{onClick:()=>{n(""),o("")},className:"clear-form-button",disabled:!e.state.isAIEnabled,children:[f.jsx(r,{icon:"faEraser",className:"button-icon"}),"Clear Form"]})]})]}),d?f.jsx("div",{className:"loading",children:"Loading saved Q&As..."}):f.jsxs("div",{className:"qa-list",children:[f.jsx("h3",{children:"Saved Q&As:"}),0===c.length?f.jsx("p",{children:"No saved Q&As."}):f.jsx("div",{className:"qa-items",children:c.map(((a,t)=>f.jsxs("div",{className:"qa-item "+(s?"":"disabled"),children:[f.jsxs("div",{className:"qa-content",children:[f.jsxs("p",{className:"qa-question",children:[f.jsx("strong",{children:"Q:"})," ",a.question]}),f.jsxs("p",{className:"qa-answer",children:[f.jsx("strong",{children:"A:"})," ",a.answer]})]}),f.jsxs("button",{className:"delete-button "+(s?"":"disabled"),onClick:()=>(e=>{N(e),j(!0),y(!1)})(a),disabled:!e.state.isAIEnabled,children:[f.jsx(r,{icon:"faTrash",className:"delete-icon"}),"Remove Q&A"]})]},t)))})]}),g&&f.jsx("div",{className:"modal-overlay",children:f.jsxs("div",{className:"delete-modal",children:[f.jsx("h2",{children:"Confirm Delete"}),f.jsx("p",{children:"Are you sure you want to delete this Q&A?"}),f.jsxs("div",{className:"modal-buttons",children:[f.jsx("button",{onClick:async()=>{y(!0),j(!1),u(c.filter((e=>e!==b))),N(null);try{await e.deleteQA(b),a.addToast("Q&A deleted successfully!",{fontSize:"16px"})}catch(s){a.errorToast(s,{fontSize:"16px"}),u((e=>[...e,b]))}finally{y(!1)}},disabled:v||!e.state.isAIEnabled,className:"delete-button",children:v?"Deleting...":"Yes, Delete"}),f.jsx("button",{onClick:()=>{j(!1),N(null)},className:"cancel-button",children:"Cancel"})]})]})})]})},q=e("ai-dashboard"),M=()=>{const e=A(),[a,s]=x.useState(!0),[t,n]=x.useState(null),[i,l]=x.useState(null),[r,c]=x.useState([]),[u,d]=x.useState(0),[h,p]=x.useState([]),[m,v]=x.useState(0),[y,g]=x.useState(0);if(x.useEffect((()=>{(async()=>{try{const e=await o();l(e)}catch(e){console.error("Error loading charts:",e),n("Failed to load charts component. Please try again later.")}})()}),[]),x.useEffect((()=>{(async()=>{try{const a=await e.fetchAnalyticsData();c(a.dailyUsage),d(a.totalActiveUsers),p(a.topLanguages),v(a.assessmentViolations),g(a.moderationViolations)}catch(a){q.error("Error fetching analytics data:",a)(),n("Failed to load analytics data. Please try again later.")}finally{s(!1)}})()}),[e]),!i)return f.jsx("div",{className:"usage-container",children:f.jsx("div",{className:"loading",children:"Loading charts..."})});const{LineChart:j,Line:b,XAxis:N,YAxis:w,CartesianGrid:E,Legend:S,ResponsiveContainer:I,Tooltip:T}=i;if(a)return f.jsx("div",{className:"usage-container",children:f.jsx("div",{className:"loading",children:"Loading data..."})});if(t)return f.jsx("div",{className:"usage-container",children:f.jsx("div",{className:"error-message",children:t})});const _={english:"🇺🇸",spanish:"🇪🇸",german:"🇩🇪",french:"🇫🇷",italian:"🇮🇹",portuguese:"🇵🇹",japanese:"🇯🇵",tagalog:"🇵🇭",mandarin:"🇨🇳",russian:"🇷🇺",arabic:"🇸🇦",hindi:"🇮🇳"},C=e=>_[e.toLowerCase()]||"🏳️";return f.jsxs("div",{className:"usage-container",children:[f.jsx("h1",{children:"Usage Analytics"}),f.jsx("h2",{className:"subheader-usage",children:"AI usage data for your course."}),f.jsxs("div",{className:"chart-section",children:[f.jsx("h2",{children:"Daily Usage"}),r.length>0?f.jsx(I,{width:"100%",height:300,children:f.jsxs(j,{data:r,margin:{top:20,right:30,left:20,bottom:5},children:[f.jsx(E,{strokeDasharray:"3 3"}),f.jsx(N,{dataKey:"date"}),f.jsx(w,{allowDataOverflow:!1,allowDecimals:!1,tickFormatter:e=>e.toLocaleString()}),f.jsx(T,{}),f.jsx(S,{}),f.jsx(b,{type:"monotone",dataKey:"chatCount",name:"Bot Invocations",stroke:"#8884d8",activeDot:{r:8},isAnimationActive:!1})]})}):f.jsx("p",{children:"No usage data available."})]}),f.jsxs("div",{className:"flex-row",children:[f.jsxs("div",{className:"metric-card",children:[f.jsx("h3",{children:"Total Active Users"}),f.jsxs("p",{className:"metric-number",children:[u," Students"]})]}),f.jsxs("div",{className:"metric-card",children:[f.jsx("h3",{children:"Top Languages Used"}),h.length>0?f.jsx("ul",{className:"languages-list",children:h.map(((e,a)=>f.jsxs("li",{className:"language-item",children:[f.jsxs("div",{className:"language-info",children:[f.jsx("span",{className:"language-flag",children:C(e.language)}),f.jsx("span",{className:"language-name",children:e.language})]}),f.jsxs("span",{className:"language-percentage",children:[e.percentage,"%"]})]},a)))}):f.jsx("p",{children:"No language data available."})]})]}),f.jsxs("div",{className:"flex-row",children:[f.jsxs("div",{className:"metric-card",children:[f.jsx("h3",{children:"Assessment Violations"}),f.jsx("p",{className:"metric-number",children:m})]}),f.jsxs("div",{className:"metric-card",children:[f.jsx("h3",{children:"Moderation Violations"}),f.jsx("p",{className:"metric-number",children:y})]})]})]})},D=e("ai-dashboard"),O=()=>{var e;const a=A(),s=a.state.features,t=(null==(e=null==s?void 0:s.AI)?void 0:e.enabled)??!0;return f.jsxs("div",{className:"ai-global-control",children:[f.jsxs("div",{className:"status-label",children:[f.jsx("span",{className:"status-indicator "+(t?"enabled":"disabled")}),f.jsxs("span",{className:"status-text",children:["AI ",t?"Enabled":"Disabled"]})]}),f.jsx("button",{className:"toggle-button "+(t?"enabled":""),onClick:async()=>{try{await a.updateFeature("AI",!t),await a.fetchAndSetFeatures()}catch(e){D.error("Failed to toggle AI:",e)()}},children:t?"Disable AI":"Enable AI"})]})};function $(){const[e,a]=x.useState("usage");return f.jsxs("div",{className:"dashboard",children:[f.jsx(T,{activePage:e,onPageChange:a}),f.jsxs("div",{className:"dashboard-content",children:[f.jsx("div",{className:"toggle-container",children:f.jsx(O,{})}),(()=>{switch(e){case"usage":default:return f.jsx(M,{});case"feature-controls":return f.jsx(_,{});case"custom-instructions":return f.jsx(C,{});case"file-management":return f.jsx(L,{});case"qas":return f.jsx(P,{})}})()]})]})}function V(){return f.jsx(g,{children:f.jsx(j,{path:"/",children:f.jsx($,{})})})}m.setOptions({strict:!1});const U=class extends c{};U.ELEMENT_NAME="AIDashboardElement",U.ELEMENT_TAG=`vapp-${a.VOSHI_APP}`,U.REACT_COMPONENT=function({webcomp:e,...s}){const t=e.isStandalone?b:N;return f.jsx(u,{messages:I,children:f.jsx(t,{basename:a.VOSHI_APP_PATH,initialIndex:0,initialEntries:[e.config.path||"/"],children:f.jsx(d,{initializing:f.jsx(h,{className:"my-4"}),children:()=>f.jsx(p,{children:f.jsx(S,{webcomp:e,coursenum:e.config.coursenum||e.getAttribute("coursenum"),children:f.jsx(V,{})})})})})})},U.CONFIG={...c.CONFIG,coursenum:void 0},U.ATTRIBUTES={...c.ATTRIBUTES,coursenum:void 0},function(t){const n=e("voshi");try{if(!a.VOSHI_APP)throw new Error("environment is missing VOSHI_APP");if(!a.VOSHI_STAGE)throw new Error("environment is missing VOSHI_STAGE");if(!a.VOSHI_BUILD)throw new Error("environment is missing VOSHI_BUILD");if(!a.VOSHI_PLATFORM)throw new Error("environment is missing VOSHI_PLATFORM");n.force("welcome to {}",a.appsig)(),a.appsig!==s.appsig&&n.force("built as {}",s.appsig)(),customElements.get(t.ELEMENT_TAG)?n.info(`custom element already defined for <${t.ELEMENT_TAG}>`)():(n.info(`defining custom element ${t.ELEMENT_NAME} for <${t.ELEMENT_TAG}>`)(),customElements.define(t.ELEMENT_TAG,t))}catch(i){n.error("Error loading app",i)()}}(U);
